<!DOCTYPE html>
<html lang="ky">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSH TERMINAL ULTIMATE CLOUD v8.0 | High-Performance System</title>
    
    <!-- Fonts & Libraries -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&family=Orbitron:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@100;200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://smtpjs.com/v3/smtp.js"></script>

    <style>
        /* =========================================================
           SECTION 1: ADVANCED CSS VARIABLES & DESIGN SYSTEM
           ========================================================= */
        :root {
            /* Color System */
            --osh-primary-hub: #0044cc;
            --osh-primary-deep: #002d8a;
            --osh-primary-soft: #4d88ff;
            --osh-accent-gold: #ffcc00;
            --osh-accent-glow: rgba(255, 204, 0, 0.4);
            --osh-state-success: #2ecc71;
            --osh-state-warning: #f1c40f;
            --osh-state-danger: #e74c3c;
            --osh-state-info: #3498db;
            
            /* Background Colors */
            --osh-bg-main: #f8fafc;
            --osh-bg-card: #ffffff;
            --osh-bg-dark: #0f172a;
            --osh-bg-darker: #020617;
            
            /* Text Colors */
            --osh-text-dark: #0f172a;
            --osh-text-muted: #64748b;
            --osh-text-light: #94a3b8;
            
            /* Border & Shadows */
            --osh-border-light: #f1f5f9;
            --osh-border-medium: #e2e8f0;
            --osh-glass-bg: rgba(255, 255, 255, 0.95);
            --osh-glass-dark: rgba(15, 23, 42, 0.95);
            
            /* Shadows */
            --osh-shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --osh-shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --osh-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --osh-shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --osh-shadow-2xl: 0 35px 60px -15px rgba(0, 0, 0, 0.3);
            
            /* Radius */
            --osh-radius-sm: 8px;
            --osh-radius-md: 16px;
            --osh-radius-lg: 24px;
            --osh-radius-xl: 32px;
            --osh-radius-2xl: 48px;
            --osh-radius-full: 9999px;
            
            /* Typography */
            --osh-font-family: 'Montserrat', sans-serif;
            --osh-font-logo: 'Orbitron', sans-serif;
            --osh-font-mono: 'JetBrains Mono', monospace;
            
            /* Transitions */
            --osh-transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --osh-transition-normal: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --osh-transition-slow: 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Spacing */
            --osh-space-xs: 0.25rem;
            --osh-space-sm: 0.5rem;
            --osh-space-md: 1rem;
            --osh-space-lg: 1.5rem;
            --osh-space-xl: 2rem;
            --osh-space-2xl: 3rem;
            --osh-space-3xl: 4rem;
        }

        /* =========================================================
           SECTION 2: GLOBAL RESET & BASE STYLES
           ========================================================= */
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }

        body {
            background-color: var(--osh-bg-main);
            color: var(--osh-text-dark);
            font-family: var(--osh-font-family);
            overflow-x: hidden;
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
        }

        /* Selection */
        ::selection {
            background-color: var(--osh-primary-soft);
            color: white;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--osh-border-light);
            border-radius: var(--osh-radius-full);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--osh-primary-hub);
            border-radius: var(--osh-radius-full);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--osh-primary-deep);
        }

        /* =========================================================
           SECTION 3: PREMIUM ANIMATIONS
           ========================================================= */
        @keyframes oshFadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes oshFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes oshSlideInRight {
            from {
                opacity: 0;
                transform: translateX(40px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes oshPulseGlow {
            0% {
                box-shadow: 0 0 0 0 rgba(0, 68, 204, 0.4);
            }
            70% {
                box-shadow: 0 0 0 20px rgba(0, 68, 204, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(0, 68, 204, 0);
            }
        }

        @keyframes oshShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        @keyframes oshSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes oshFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes oshGradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Animation Classes */
        .animate-up {
            animation: oshFadeInUp 0.8s var(--osh-transition-normal) forwards;
        }

        .animate-fade {
            animation: oshFadeIn 0.6s ease forwards;
        }

        .animate-slide {
            animation: oshSlideInRight 0.6s ease forwards;
        }

        .animate-pulse-glow {
            animation: oshPulseGlow 2s infinite;
        }

        .animate-float {
            animation: oshFloat 3s ease-in-out infinite;
        }

        .animate-gradient {
            background-size: 200% 200%;
            animation: oshGradientShift 3s ease infinite;
        }

        /* =========================================================
           SECTION 4: HEADER & NAVIGATION
           ========================================================= */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: var(--osh-glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 8%;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: var(--osh-shadow-md);
            transition: var(--osh-transition-normal);
        }

        header.scrolled {
            height: 80px;
            box-shadow: var(--osh-shadow-lg);
        }

        .brand-container {
            display: flex;
            align-items: center;
            gap: var(--osh-space-lg);
            cursor: pointer;
            transition: var(--osh-transition-fast);
        }

        .brand-container:hover {
            transform: translateY(-2px);
        }

        .brand-logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--osh-primary-hub), var(--osh-primary-deep));
            border-radius: var(--osh-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: var(--osh-font-logo);
            font-size: 2rem;
            font-weight: 900;
            box-shadow: 0 10px 30px rgba(0, 68, 204, 0.3);
            position: relative;
            overflow: hidden;
        }

        .brand-logo::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.1) 50%,
                transparent 70%
            );
            animation: oshSpin 3s linear infinite;
        }

        .brand-text {
            display: flex;
            flex-direction: column;
        }

        .brand-title {
            font-weight: 900;
            font-size: 1.5rem;
            line-height: 1;
            color: var(--osh-text-dark);
            letter-spacing: -0.5px;
        }

        .brand-subtitle {
            font-size: 0.75rem;
            color: var(--osh-text-muted);
            font-weight: 800;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-top: 2px;
        }

        .nav-links-wrapper {
            display: flex;
            align-items: center;
            gap: var(--osh-space-2xl);
        }

        .nav-item {
            text-decoration: none;
            color: var(--osh-text-muted);
            font-weight: 700;
            font-size: 0.875rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            position: relative;
            padding: var(--osh-space-sm) 0;
            transition: var(--osh-transition-fast);
        }

        .nav-item::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--osh-primary-hub), var(--osh-accent-gold));
            border-radius: var(--osh-radius-full);
            transition: var(--osh-transition-normal);
        }

        .nav-item:hover {
            color: var(--osh-primary-hub);
        }

        .nav-item:hover::before {
            width: 100%;
        }

        .nav-item.active {
            color: var(--osh-primary-hub);
        }

        .nav-item.active::before {
            width: 100%;
        }

        /* Language Selector - Right Corner */
        .language-selector {
            position: fixed;
            top: var(--osh-space-xl);
            right: var(--osh-space-xl);
            z-index: 1001;
            display: flex;
            gap: var(--osh-space-xs);
            background: var(--osh-glass-dark);
            backdrop-filter: blur(10px);
            border-radius: var(--osh-radius-full);
            padding: var(--osh-space-xs);
            box-shadow: var(--osh-shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .lang-btn {
            padding: var(--osh-space-sm) var(--osh-space-md);
            background: transparent;
            border: none;
            border-radius: var(--osh-radius-full);
            color: var(--osh-text-light);
            font-weight: 700;
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--osh-transition-fast);
            text-transform: uppercase;
            min-width: 50px;
            text-align: center;
        }

        .lang-btn:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }

        .lang-btn.active {
            color: white;
            background: var(--osh-primary-hub);
            box-shadow: 0 5px 15px rgba(0, 68, 204, 0.3);
        }

        /* =========================================================
           SECTION 5: HERO SECTION
           ========================================================= */
        .hero-engine {
            height: 85vh;
            min-height: 600px;
            background: linear-gradient(135deg,
                rgba(15, 23, 42, 0.95) 0%,
                rgba(0, 68, 204, 0.85) 100%),
                url('https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?auto=format&fit=crop&q=80&w=2000');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            padding: 0 5%;
            position: relative;
            overflow: hidden;
        }

        .hero-engine::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(
                circle at 30% 50%,
                rgba(0, 68, 204, 0.2) 0%,
                transparent 50%
            );
            pointer-events: none;
        }

        .hero-title {
            font-family: var(--osh-font-logo);
            font-size: 6rem;
            font-weight: 900;
            letter-spacing: -3px;
            line-height: 0.9;
            margin-bottom: var(--osh-space-xl);
            text-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            background: linear-gradient(135deg, #ffffff 0%, var(--osh-accent-gold) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            max-width: 800px;
            margin: 0 auto var(--osh-space-2xl);
            opacity: 0.9;
            line-height: 1.8;
            font-weight: 300;
        }

        .hero-stats {
            display: flex;
            gap: var(--osh-space-2xl);
            margin-top: var(--osh-space-2xl);
        }

        .hero-stat {
            text-align: center;
        }

        .hero-stat-number {
            font-size: 3rem;
            font-weight: 900;
            font-family: var(--osh-font-mono);
            color: var(--osh-accent-gold);
            line-height: 1;
            margin-bottom: var(--osh-space-xs);
        }

        .hero-stat-label {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.7;
        }

        /* =========================================================
           SECTION 6: MAIN CONTENT AREA
           ========================================================= */
        .main-wrapper {
            max-width: 1600px;
            margin: -80px auto 0;
            padding: 0 5% 100px;
            position: relative;
            z-index: 50;
        }

        /* Stats Dashboard */
        .stats-engine-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--osh-space-xl);
            margin-bottom: var(--osh-space-3xl);
        }

        .stat-module {
            background: var(--osh-bg-card);
            padding: var(--osh-space-2xl);
            border-radius: var(--osh-radius-2xl);
            box-shadow: var(--osh-shadow-2xl);
            border: 1px solid rgba(255, 255, 255, 0.7);
            display: flex;
            flex-direction: column;
            gap: var(--osh-space-md);
            transition: var(--osh-transition-normal);
            position: relative;
            overflow: hidden;
        }

        .stat-module::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--osh-primary-hub), var(--osh-accent-gold));
        }

        .stat-module:hover {
            transform: translateY(-10px);
            box-shadow: var(--osh-shadow-2xl);
        }

        .stat-label {
            font-size: 0.75rem;
            font-weight: 900;
            color: var(--osh-text-muted);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .stat-value {
            font-size: 3rem;
            font-weight: 900;
            font-family: var(--osh-font-mono);
            color: var(--osh-text-dark);
            line-height: 1;
        }

        .stat-value.highlight {
            color: var(--osh-state-success);
        }

        .stat-value.warning {
            color: var(--osh-state-warning);
        }

        .stat-trend {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: var(--osh-space-xs);
        }

        .trend-up {
            color: var(--osh-state-success);
        }

        .trend-down {
            color: var(--osh-state-danger);
        }

        /* =========================================================
           SECTION 7: ROUTES MODULE
           ========================================================= */
        .routes-section-title {
            font-size: 3.5rem;
            font-weight: 900;
            text-align: center;
            margin-bottom: var(--osh-space-3xl);
            color: var(--osh-text-dark);
            position: relative;
            display: inline-block;
            left: 50%;
            transform: translateX(-50%);
        }

        .routes-section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 25%;
            width: 50%;
            height: 4px;
            background: linear-gradient(90deg, var(--osh-primary-hub), var(--osh-accent-gold));
            border-radius: var(--osh-radius-full);
        }

        .routes-container-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
            gap: var(--osh-space-2xl);
            margin-bottom: var(--osh-space-3xl);
        }

        .route-card-premium {
            background: var(--osh-bg-card);
            border-radius: var(--osh-radius-2xl);
            padding: var(--osh-space-2xl);
            box-shadow: var(--osh-shadow-xl);
            position: relative;
            overflow: hidden;
            border: 1px solid transparent;
            transition: var(--osh-transition-normal);
        }

        .route-card-premium::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                135deg,
                rgba(0, 68, 204, 0.05) 0%,
                rgba(255, 204, 0, 0.05) 100%
            );
            opacity: 0;
            transition: var(--osh-transition-normal);
        }

        .route-card-premium:hover::before {
            opacity: 1;
        }

        .route-card-premium:hover {
            border-color: var(--osh-primary-soft);
            box-shadow: var(--osh-shadow-2xl);
            transform: translateY(-5px);
        }

        .route-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--osh-space-lg);
        }

        .route-id {
            font-weight: 900;
            color: var(--osh-text-muted);
            font-size: 0.75rem;
            letter-spacing: 1px;
        }

        .route-status {
            padding: var(--osh-space-xs) var(--osh-space-md);
            border-radius: var(--osh-radius-full);
            font-size: 0.75rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-active {
            background: rgba(46, 204, 113, 0.1);
            color: var(--osh-state-success);
        }

        .status-soldout {
            background: rgba(231, 76, 60, 0.1);
            color: var(--osh-state-danger);
        }

        .status-upcoming {
            background: rgba(52, 152, 219, 0.1);
            color: var(--osh-state-info);
        }

        .dest-title {
            font-size: 2.5rem;
            font-weight: 900;
            margin: var(--osh-space-xl) 0;
            display: flex;
            align-items: center;
            gap: var(--osh-space-lg);
            color: var(--osh-text-dark);
        }

        .dest-arrow {
            color: var(--osh-primary-hub);
            font-size: 2rem;
        }

        .info-strip {
            background: var(--osh-bg-main);
            padding: var(--osh-space-xl);
            border-radius: var(--osh-radius-xl);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--osh-space-lg);
            margin-bottom: var(--osh-space-xl);
            border: 1px solid var(--osh-border-light);
        }

        .strip-item {
            display: flex;
            flex-direction: column;
            gap: var(--osh-space-xs);
        }

        .strip-label {
            font-size: 0.75rem;
            color: var(--osh-text-muted);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .strip-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--osh-text-dark);
        }

        .route-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: var(--osh-space-xl);
        }

        .price-container {
            display: flex;
            flex-direction: column;
        }

        .price-label {
            font-size: 0.75rem;
            color: var(--osh-text-muted);
            font-weight: 800;
            text-transform: uppercase;
            margin-bottom: var(--osh-space-xs);
        }

        .price-amount {
            font-size: 2.5rem;
            font-weight: 900;
            font-family: var(--osh-font-mono);
            color: var(--osh-text-dark);
        }

        /* =========================================================
           SECTION 8: BUTTONS SYSTEM
           ========================================================= */
        .btn-osh-main {
            padding: var(--osh-space-lg) var(--osh-space-2xl);
            border-radius: var(--osh-radius-xl);
            border: none;
            background: linear-gradient(135deg, var(--osh-primary-hub), var(--osh-primary-deep));
            color: white;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            box-shadow: 0 15px 35px rgba(0, 68, 204, 0.3);
            transition: var(--osh-transition-normal);
            position: relative;
            overflow: hidden;
            font-size: 0.875rem;
        }

        .btn-osh-main::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.2),
                transparent
            );
            transition: var(--osh-transition-normal);
        }

        .btn-osh-main:hover::before {
            left: 100%;
        }

        .btn-osh-main:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 68, 204, 0.5);
        }

        .btn-osh-main:active {
            transform: translateY(-2px);
        }

        .btn-osh-main:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1) !important;
        }

        .btn-osh-secondary {
            padding: var(--osh-space-lg) var(--osh-space-2xl);
            border-radius: var(--osh-radius-xl);
            border: 2px solid var(--osh-primary-hub);
            background: transparent;
            color: var(--osh-primary-hub);
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: var(--osh-transition-normal);
            font-size: 0.875rem;
        }

        .btn-osh-secondary:hover {
            background: var(--osh-primary-hub);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 68, 204, 0.2);
        }

        .btn-osh-danger {
            background: linear-gradient(135deg, var(--osh-state-danger), #c0392b);
        }

        .btn-osh-success {
            background: linear-gradient(135deg, var(--osh-state-success), #27ae60);
        }

        .btn-osh-warning {
            background: linear-gradient(135deg, var(--osh-state-warning), #f39c12);
        }

        /* =========================================================
           SECTION 9: SEAT MAP ENGINE
           ========================================================= */
        .sprinter-map-hub {
            background: var(--osh-bg-main);
            padding: var(--osh-space-2xl);
            border-radius: var(--osh-radius-2xl);
            width: 100%;
            max-width: 400px;
            margin: var(--osh-space-xl) auto;
            border: 2px solid var(--osh-border-medium);
            box-shadow: inset 0 10px 30px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .map-header {
            text-align: center;
            margin-bottom: var(--osh-space-xl);
        }

        .map-title {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--osh-text-dark);
            margin-bottom: var(--osh-space-xs);
        }

        .map-subtitle {
            color: var(--osh-text-muted);
            font-size: 0.875rem;
        }

        .cabin-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--osh-space-lg);
            margin-bottom: var(--osh-space-xl);
        }

        .seat-core {
            width: 70px;
            height: 70px;
            background: white;
            border-radius: var(--osh-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.25rem;
            cursor: pointer;
            box-shadow: 0 8px 0 var(--osh-border-medium);
            border: 2px solid transparent;
            transition: var(--osh-transition-fast);
            user-select: none;
            position: relative;
            margin: 0 auto;
        }

        .seat-core:hover:not(.occupied):not(.driver) {
            transform: translateY(-2px);
            box-shadow: 0 10px 0 var(--osh-border-medium);
            border-color: var(--osh-primary-soft);
        }

        .seat-core.occupied {
            background: var(--osh-text-muted);
            color: white;
            cursor: not-allowed;
            box-shadow: none;
            transform: translateY(6px);
            opacity: 0.7;
        }

        .seat-core.selected {
            background: linear-gradient(135deg, var(--osh-state-success), #27ae60);
            color: white;
            border-color: var(--osh-state-success);
            box-shadow: 0 8px 0 rgba(46, 204, 113, 0.3);
        }

        .seat-core.driver {
            background: var(--osh-text-dark);
            color: white;
            grid-column: 3;
            cursor: default;
            box-shadow: 0 8px 0 rgba(15, 23, 42, 0.3);
        }

        .seat-core.vip {
            background: linear-gradient(135deg, var(--osh-accent-gold), #ff9900);
            color: var(--osh-text-dark);
            box-shadow: 0 8px 0 rgba(255, 204, 0, 0.3);
        }

        .seat-label {
            font-size: 0.75rem;
            color: var(--osh-text-muted);
            text-align: center;
            margin-top: var(--osh-space-md);
        }

        .seat-legend {
            display: flex;
            justify-content: center;
            gap: var(--osh-space-xl);
            margin-top: var(--osh-space-xl);
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: var(--osh-space-sm);
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-text {
            font-size: 0.875rem;
            color: var(--osh-text-muted);
        }

        /* =========================================================
           SECTION 10: ADMINISTRATOR PANEL
           ========================================================= */
        .admin-login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: var(--osh-space-xl);
        }

        .admin-login-container {
            background: var(--osh-bg-darker);
            border-radius: var(--osh-radius-2xl);
            padding: var(--osh-space-3xl);
            max-width: 500px;
            width: 100%;
            box-shadow: var(--osh-shadow-2xl);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .admin-login-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(0, 68, 204, 0.1) 50%,
                transparent 70%
            );
            animation: oshSpin 20s linear infinite;
        }

        .admin-login-header {
            text-align: center;
            margin-bottom: var(--osh-space-2xl);
            position: relative;
            z-index: 1;
        }

        .admin-login-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--osh-primary-hub), var(--osh-accent-gold));
            border-radius: var(--osh-radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: var(--osh-font-logo);
            font-size: 2.5rem;
            font-weight: 900;
            margin: 0 auto var(--osh-space-lg);
            box-shadow: 0 15px 35px rgba(0, 68, 204, 0.3);
        }

        .admin-login-title {
            color: white;
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: var(--osh-space-xs);
        }

        .admin-login-subtitle {
            color: var(--osh-text-light);
            font-size: 0.875rem;
            opacity: 0.7;
        }

        .admin-input-group {
            margin-bottom: var(--osh-space-xl);
            position: relative;
            z-index: 1;
        }

        .admin-input {
            width: 100%;
            padding: var(--osh-space-lg) var(--osh-space-xl);
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--osh-radius-lg);
            color: white;
            font-size: 1rem;
            font-family: var(--osh-font-family);
            transition: var(--osh-transition-normal);
        }

        .admin-input:focus {
            outline: none;
            border-color: var(--osh-primary-hub);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(0, 68, 204, 0.1);
        }

        .admin-input::placeholder {
            color: var(--osh-text-light);
            opacity: 0.5;
        }

        .admin-checkbox-group {
            display: flex;
            align-items: center;
            gap: var(--osh-space-sm);
            margin-bottom: var(--osh-space-xl);
            position: relative;
            z-index: 1;
        }

        .admin-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            cursor: pointer;
            transition: var(--osh-transition-fast);
        }

        .admin-checkbox:checked {
            background: var(--osh-primary-hub);
            border-color: var(--osh-primary-hub);
        }

        .checkbox-label {
            color: var(--osh-text-light);
            font-size: 0.875rem;
            cursor: pointer;
        }

        .admin-error-message {
            color: var(--osh-state-danger);
            font-size: 0.875rem;
            margin-top: var(--osh-space-sm);
            display: none;
            text-align: center;
        }

        /* Admin Panel Main */
        .admin-panel-main {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--osh-bg-main);
            z-index: 1999;
            display: none;
            overflow-y: auto;
        }

        .admin-header {
            background: linear-gradient(135deg, var(--osh-primary-hub), var(--osh-primary-deep));
            color: white;
            padding: var(--osh-space-2xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--osh-shadow-xl);
        }

        .admin-header-info {
            display: flex;
            align-items: center;
            gap: var(--osh-space-lg);
        }

        .admin-user-avatar {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: var(--osh-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--osh-primary-hub);
            font-size: 1.5rem;
            font-weight: 900;
        }

        .admin-user-info h2 {
            font-size: 1.5rem;
            font-weight: 900;
            margin-bottom: var(--osh-space-xs);
        }

        .admin-user-info p {
            opacity: 0.8;
            font-size: 0.875rem;
        }

        .admin-nav {
            display: flex;
            background: var(--osh-bg-card);
            padding: var(--osh-space-md);
            border-radius: var(--osh-radius-lg);
            margin: var(--osh-space-xl);
            box-shadow: var(--osh-shadow-md);
        }

        .admin-nav-btn {
            padding: var(--osh-space-md) var(--osh-space-xl);
            border: none;
            background: transparent;
            color: var(--osh-text-muted);
            font-weight: 700;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--osh-transition-fast);
            border-radius: var(--osh-radius-md);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .admin-nav-btn:hover {
            color: var(--osh-primary-hub);
            background: rgba(0, 68, 204, 0.05);
        }

        .admin-nav-btn.active {
            color: var(--osh-primary-hub);
            background: rgba(0, 68, 204, 0.1);
        }

        .admin-content {
            padding: 0 var(--osh-space-xl) var(--osh-space-3xl);
        }

        .admin-section {
            display: none;
            background: var(--osh-bg-card);
            border-radius: var(--osh-radius-2xl);
            padding: var(--osh-space-2xl);
            box-shadow: var(--osh-shadow-xl);
            margin-bottom: var(--osh-space-xl);
        }

        .admin-section.active {
            display: block;
            animation: oshFadeInUp 0.6s ease forwards;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--osh-space-2xl);
            padding-bottom: var(--osh-space-lg);
            border-bottom: 2px solid var(--osh-border-light);
        }

        .section-title {
            font-size: 2rem;
            font-weight: 900;
            color: var(--osh-text-dark);
            display: flex;
            align-items: center;
            gap: var(--osh-space-md);
        }

        .section-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--osh-primary-hub), var(--osh-primary-soft));
            border-radius: var(--osh-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        /* Revenue Statistics (Hidden from public) */
        .revenue-stats {
            background: linear-gradient(135deg, var(--osh-primary-deep), var(--osh-text-dark));
            color: white;
            border-radius: var(--osh-radius-2xl);
            padding: var(--osh-space-2xl);
            margin-bottom: var(--osh-space-2xl);
            display: none; /* Hidden by default */
        }

        .admin-section.active .revenue-stats {
            display: block;
        }

        .revenue-title {
            font-size: 1.5rem;
            font-weight: 900;
            margin-bottom: var(--osh-space-xl);
            text-align: center;
            color: white;
        }

        .revenue-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--osh-space-lg);
        }

        .revenue-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--osh-radius-xl);
            padding: var(--osh-space-xl);
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .revenue-label {
            font-size: 0.875rem;
            opacity: 0.8;
            margin-bottom: var(--osh-space-sm);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .revenue-value {
            font-size: 2.5rem;
            font-weight: 900;
            font-family: var(--osh-font-mono);
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--osh-space-lg);
            margin-bottom: var(--osh-space-lg);
        }

        .form-group {
            margin-bottom: var(--osh-space-xl);
        }

        .form-label {
            display: block;
            margin-bottom: var(--osh-space-sm);
            font-weight: 700;
            color: var(--osh-text-dark);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-input {
            width: 100%;
            padding: var(--osh-space-lg) var(--osh-space-xl);
            border: 2px solid var(--osh-border-light);
            border-radius: var(--osh-radius-lg);
            font-size: 1rem;
            font-family: var(--osh-font-family);
            transition: var(--osh-transition-normal);
            background: var(--osh-bg-main);
        }

        .form-input:focus {
            border-color: var(--osh-primary-hub);
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 68, 204, 0.1);
            background: white;
        }

        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2364748b' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 16px;
            padding-right: 3rem;
        }

        /* Tables */
        .admin-table-container {
            overflow-x: auto;
            border-radius: var(--osh-radius-xl);
            border: 1px solid var(--osh-border-light);
            box-shadow: var(--osh-shadow-md);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .admin-table thead {
            background: linear-gradient(135deg, var(--osh-primary-hub), var(--osh-primary-deep));
        }

        .admin-table th {
            padding: var(--osh-space-lg) var(--osh-space-xl);
            text-align: left;
            color: white;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.875rem;
        }

        .admin-table tbody tr {
            border-bottom: 1px solid var(--osh-border-light);
            transition: var(--osh-transition-fast);
        }

        .admin-table tbody tr:hover {
            background: var(--osh-bg-main);
        }

        .admin-table td {
            padding: var(--osh-space-lg) var(--osh-space-xl);
            color: var(--osh-text-dark);
        }

        .table-actions {
            display: flex;
            gap: var(--osh-space-xs);
        }

        /* =========================================================
           SECTION 11: TICKET ENGINE & QR
           ========================================================= */
        .ticket-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: var(--osh-space-xl);
        }

        .ticket-view-hub {
            width: 100%;
            max-width: 500px;
            background: white;
            border-radius: var(--osh-radius-2xl);
            overflow: hidden;
            box-shadow: var(--osh-shadow-2xl);
            animation: oshFadeInUp 0.6s ease forwards;
        }

        .ticket-header {
            background: linear-gradient(135deg, var(--osh-primary-hub), var(--osh-primary-deep));
            padding: var(--osh-space-2xl);
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .ticket-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.1) 50%,
                transparent 70%
            );
            animation: oshSpin 10s linear infinite;
        }

        .ticket-logo {
            font-family: var(--osh-font-logo);
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: var(--osh-space-xs);
            position: relative;
            z-index: 1;
            color: var(--osh-accent-gold);
        }

        .ticket-subtitle {
            font-size: 0.875rem;
            opacity: 0.8;
            position: relative;
            z-index: 1;
            letter-spacing: 2px;
        }

        .ticket-body {
            padding: var(--osh-space-2xl);
        }

        .ticket-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--osh-space-xl);
            margin-bottom: var(--osh-space-xl);
        }

        .ticket-info-item {
            display: flex;
            flex-direction: column;
            gap: var(--osh-space-xs);
        }

        .ticket-label {
            font-size: 0.75rem;
            color: var(--osh-text-muted);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .ticket-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--osh-text-dark);
        }

        .ticket-divider {
            height: 1px;
            background: var(--osh-border-light);
            margin: var(--osh-space-xl) 0;
            position: relative;
        }

        .ticket-divider::before,
        .ticket-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            border: 1px solid var(--osh-border-light);
        }

        .ticket-divider::before {
            left: -10px;
        }

        .ticket-divider::after {
            right: -10px;
        }

        .ticket-qr-section {
            text-align: center;
            padding: var(--osh-space-xl);
            background: var(--osh-bg-main);
            border-radius: var(--osh-radius-xl);
            margin-bottom: var(--osh-space-xl);
            border: 2px dashed var(--osh-border-light);
        }

        #ticket-qr-code {
            display: inline-block;
            margin-bottom: var(--osh-space-lg);
            padding: var(--osh-space-md);
            background: white;
            border-radius: var(--osh-radius-lg);
            box-shadow: var(--osh-shadow-md);
        }

        .ticket-id {
            font-family: var(--osh-font-mono);
            font-weight: 700;
            color: var(--osh-text-dark);
            font-size: 1.25rem;
            letter-spacing: 2px;
            margin-bottom: var(--osh-space-sm);
        }

        .ticket-footer {
            padding: var(--osh-space-xl);
            background: var(--osh-bg-main);
            text-align: center;
            border-top: 3px dashed var(--osh-border-light);
        }

        .ticket-timestamp {
            font-size: 0.875rem;
            color: var(--osh-text-muted);
        }

        /* =========================================================
           SECTION 12: DRIVER PORTAL
           ========================================================= */
        .driver-portal-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3001;
            padding: var(--osh-space-xl);
        }

        .driver-portal-container {
            width: 100%;
            max-width: 1200px;
            background: var(--osh-bg-darker);
            border-radius: var(--osh-radius-2xl);
            overflow: hidden;
            box-shadow: var(--osh-shadow-2xl);
            animation: oshFadeInUp 0.6s ease forwards;
        }

        .driver-header {
            background: linear-gradient(135deg, var(--osh-primary-hub), var(--osh-primary-deep));
            padding: var(--osh-space-2xl);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .driver-info {
            display: flex;
            align-items: center;
            gap: var(--osh-space-lg);
        }

        .driver-avatar {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: var(--osh-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--osh-primary-hub);
            font-size: 2rem;
            font-weight: 900;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .driver-details h2 {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: var(--osh-space-xs);
        }

        .driver-details p {
            opacity: 0.8;
            font-size: 1rem;
        }

        .driver-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--osh-space-2xl);
            padding: var(--osh-space-2xl);
        }

        .scanner-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--osh-radius-2xl);
            padding: var(--osh-space-2xl);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .scanner-title {
            color: white;
            font-size: 1.5rem;
            font-weight: 900;
            margin-bottom: var(--osh-space-xl);
            display: flex;
            align-items: center;
            gap: var(--osh-space-md);
        }

        #qr-scanner-region {
            width: 100%;
            height: 300px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: var(--osh-radius-xl);
            overflow: hidden;
            margin-bottom: var(--osh-space-xl);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .passenger-list-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--osh-radius-2xl);
            padding: var(--osh-space-2xl);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 600px;
            overflow-y: auto;
        }

        .passenger-list-title {
            color: white;
            font-size: 1.5rem;
            font-weight: 900;
            margin-bottom: var(--osh-space-xl);
        }

        .passenger-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--osh-radius-lg);
            padding: var(--osh-space-lg);
            margin-bottom: var(--osh-space-md);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: var(--osh-transition-fast);
        }

        .passenger-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .passenger-card.checked {
            border-color: var(--osh-state-success);
            background: rgba(46, 204, 113, 0.1);
        }

        .passenger-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .passenger-name {
            color: white;
            font-weight: 700;
            font-size: 1.125rem;
        }

        .passenger-seat {
            color: var(--osh-accent-gold);
            font-weight: 900;
            font-size: 1.25rem;
        }

        .passenger-status {
            display: inline-block;
            padding: var(--osh-space-xs) var(--osh-space-md);
            border-radius: var(--osh-radius-full);
            font-size: 0.75rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: var(--osh-space-sm);
        }

        .status-pending {
            background: rgba(241, 196, 15, 0.2);
            color: var(--osh-state-warning);
        }

        .status-checked {
            background: rgba(46, 204, 113, 0.2);
            color: var(--osh-state-success);
        }

        /* =========================================================
           SECTION 13: NOTIFICATIONS & ALERTS
           ========================================================= */
        .notification-container {
            position: fixed;
            top: 120px;
            right: var(--osh-space-xl);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: var(--osh-space-md);
            max-width: 400px;
            width: 100%;
        }

        .notification {
            padding: var(--osh-space-lg) var(--osh-space-xl);
            border-radius: var(--osh-radius-lg);
            color: white;
            font-weight: 700;
            box-shadow: var(--osh-shadow-xl);
            animation: oshFadeInUp 0.3s ease forwards;
            display: flex;
            align-items: center;
            gap: var(--osh-space-md);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .notification-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .notification.success {
            background: linear-gradient(135deg, var(--osh-state-success), #27ae60);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--osh-state-danger), #c0392b);
        }

        .notification.warning {
            background: linear-gradient(135deg, var(--osh-state-warning), #f39c12);
            color: var(--osh-text-dark);
        }

        .notification.info {
            background: linear-gradient(135deg, var(--osh-state-info), #2980b9);
        }

        /* =========================================================
           SECTION 14: LOADING STATES
           ========================================================= */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--osh-primary-hub);
            animation: oshSpin 1s linear infinite;
        }

        .loading-text {
            color: white;
            font-weight: 700;
            margin-top: var(--osh-space-xl);
            font-size: 1.125rem;
            text-align: center;
        }

        /* =========================================================
           SECTION 15: FOOTER
           ========================================================= */
        footer {
            background: var(--osh-bg-darker);
            color: white;
            padding: 150px 8% 80px;
            margin-top: 200px;
            position: relative;
        }

        footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--osh-primary-hub), transparent);
        }

        .footer-content {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: var(--osh-space-2xl);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 100px;
            margin-bottom: var(--osh-space-2xl);
        }

        .footer-logo {
            font-family: var(--osh-font-logo);
            color: var(--osh-accent-gold);
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: var(--osh-space-xl);
            display: block;
        }

        .footer-description {
            opacity: 0.6;
            line-height: 1.8;
            font-size: 0.9375rem;
            max-width: 400px;
        }

        .footer-section h4 {
            color: white;
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: var(--osh-space-xl);
            position: relative;
            padding-bottom: var(--osh-space-md);
        }

        .footer-section h4::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 2px;
            background: var(--osh-accent-gold);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: var(--osh-space-md);
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.6);
            text-decoration: none;
            font-size: 0.9375rem;
            transition: var(--osh-transition-fast);
        }

        .footer-links a:hover {
            color: white;
            padding-left: var(--osh-space-sm);
        }

        .tech-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--osh-space-sm);
        }

        .tech-tag {
            background: rgba(255, 255, 255, 0.1);
            padding: var(--osh-space-xs) var(--osh-space-md);
            border-radius: var(--osh-radius-full);
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .footer-bottom {
            text-align: center;
            opacity: 0.4;
            font-size: 0.875rem;
            letter-spacing: 1px;
            padding-top: var(--osh-space-xl);
        }

        /* =========================================================
           SECTION 16: RESPONSIVE DESIGN
           ========================================================= */
        @media (max-width: 1400px) {
            .hero-title {
                font-size: 5rem;
            }
            
            .routes-container-grid {
                grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            }
            
            .stats-engine-row {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 1200px) {
            .hero-title {
                font-size: 4rem;
            }
            
            .footer-content {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .driver-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            header {
                padding: 0 5%;
            }
            
            .nav-links-wrapper {
                gap: var(--osh-space-lg);
            }
            
            .hero-title {
                font-size: 3.5rem;
            }
            
            .routes-container-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-nav {
                flex-wrap: wrap;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            header {
                height: 80px;
            }
            
            .brand-logo {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
            
            .brand-title {
                font-size: 1.25rem;
            }
            
            .hero-engine {
                height: 70vh;
            }
            
            .hero-title {
                font-size: 2.5rem;
                letter-spacing: -1px;
            }
            
            .hero-subtitle {
                font-size: 1rem;
            }
            
            .hero-stats {
                flex-wrap: wrap;
                justify-content: center;
                gap: var(--osh-space-xl);
            }
            
            .stat-value {
                font-size: 2.5rem;
            }
            
            .dest-title {
                font-size: 2rem;
            }
            
            .price-amount {
                font-size: 2rem;
            }
            
            .admin-login-container {
                padding: var(--osh-space-2xl);
            }
            
            .revenue-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .language-selector {
                top: var(--osh-space-lg);
                right: var(--osh-space-lg);
            }
        }

        @media (max-width: 576px) {
            .hero-title {
                font-size: 2rem;
            }
            
            .stats-engine-row {
                grid-template-columns: 1fr;
            }
            
            .routes-section-title {
                font-size: 2.5rem;
            }
            
            .info-strip {
                grid-template-columns: 1fr;
            }
            
            .route-footer {
                flex-direction: column;
                gap: var(--osh-space-xl);
                text-align: center;
            }
            
            .cabin-grid {
                gap: var(--osh-space-md);
            }
            
            .seat-core {
                width: 60px;
                height: 60px;
                font-size: 1rem;
            }
            
            .admin-login-container {
                padding: var(--osh-space-xl);
            }
            
            .admin-header {
                flex-direction: column;
                gap: var(--osh-space-xl);
                text-align: center;
            }
            
            .revenue-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
            }
            
            .language-selector {
                top: var(--osh-space-md);
                right: var(--osh-space-md);
            }
        }

        @media (max-width: 400px) {
            .hero-title {
                font-size: 1.75rem;
            }
            
            .seat-core {
                width: 50px;
                height: 50px;
            }
            
            .btn-osh-main,
            .btn-osh-secondary {
                padding: var(--osh-space-md) var(--osh-space-lg);
                font-size: 0.75rem;
            }
            
            .admin-nav-btn {
                padding: var(--osh-space-sm) var(--osh-space-md);
                font-size: 0.75rem;
            }
        }

        /* =========================================================
           SECTION 17: UTILITY CLASSES
           ========================================================= */
        .hidden {
            display: none !important;
        }

        .visible {
            display: block !important;
        }

        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .text-left {
            text-align: left;
        }

        .mt-1 { margin-top: var(--osh-space-xs); }
        .mt-2 { margin-top: var(--osh-space-sm); }
        .mt-3 { margin-top: var(--osh-space-md); }
        .mt-4 { margin-top: var(--osh-space-lg); }
        .mt-5 { margin-top: var(--osh-space-xl); }
        .mt-6 { margin-top: var(--osh-space-2xl); }

        .mb-1 { margin-bottom: var(--osh-space-xs); }
        .mb-2 { margin-bottom: var(--osh-space-sm); }
        .mb-3 { margin-bottom: var(--osh-space-md); }
        .mb-4 { margin-bottom: var(--osh-space-lg); }
        .mb-5 { margin-bottom: var(--osh-space-xl); }
        .mb-6 { margin-bottom: var(--osh-space-2xl); }

        .p-1 { padding: var(--osh-space-xs); }
        .p-2 { padding: var(--osh-space-sm); }
        .p-3 { padding: var(--osh-space-md); }
        .p-4 { padding: var(--osh-space-lg); }
        .p-5 { padding: var(--osh-space-xl); }
        .p-6 { padding: var(--osh-space-2xl); }

        .gap-1 { gap: var(--osh-space-xs); }
        .gap-2 { gap: var(--osh-space-sm); }
        .gap-3 { gap: var(--osh-space-md); }
        .gap-4 { gap: var(--osh-space-lg); }
        .gap-5 { gap: var(--osh-space-xl); }
        .gap-6 { gap: var(--osh-space-2xl); }

        .w-100 { width: 100%; }
        .h-100 { height: 100%; }

        .rounded-sm { border-radius: var(--osh-radius-sm); }
        .rounded-md { border-radius: var(--osh-radius-md); }
        .rounded-lg { border-radius: var(--osh-radius-lg); }
        .rounded-xl { border-radius: var(--osh-radius-xl); }
        .rounded-2xl { border-radius: var(--osh-radius-2xl); }
        .rounded-full { border-radius: var(--osh-radius-full); }

        .shadow-sm { box-shadow: var(--osh-shadow-sm); }
        .shadow-md { box-shadow: var(--osh-shadow-md); }
        .shadow-lg { box-shadow: var(--osh-shadow-lg); }
        .shadow-xl { box-shadow: var(--osh-shadow-xl); }
        .shadow-2xl { box-shadow: var(--osh-shadow-2xl); }

        /* =========================================================
           SECTION 18: PRINT STYLES
           ========================================================= */
        @media print {
            header,
            footer,
            .language-selector,
            .admin-login-modal,
            .admin-panel-main,
            .driver-portal-modal,
            .ticket-modal .btn-osh-main:not(.print-btn) {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
            
            .ticket-view-hub {
                max-width: 100% !important;
                box-shadow: none !important;
                border: 1px solid #ddd !important;
                margin: 0 !important;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>

<!-- Loading Overlay -->
<div id="loading-overlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <div class="loading-text" id="loading-text"> ...</div>
</div>

<!-- Notification Container -->
<div class="notification-container" id="notification-container"></div>

<!-- Language Selector (Top Right) -->
<div class="language-selector">
    <button class="lang-btn active" onclick="coreEngine.switchLanguage('ky')">KG</button>
    <button class="lang-btn" onclick="coreEngine.switchLanguage('ru')">RU</button>
    <button class="lang-btn" onclick="coreEngine.switchLanguage('en')">EN</button>
</div>

<!-- Main Header -->
<header id="main-header">
    <div class="brand-container" onclick="location.reload()">
        <div class="brand-logo">O</div>
        <div class="brand-text">
            <span class="brand-title">OSH TERMINAL</span>
            <span class="brand-subtitle">ENTERPRISE CLOUD v8.0</span>
        </div>
    </div>

    <nav class="nav-links-wrapper">
        <a href="#" class="nav-item active"></a>
        <a href="#" class="nav-item" onclick="coreEngine.openDriverPortal()"></a>
        <a href="#" class="nav-item" onclick="coreEngine.openAdminLogin()"></a>
        <button class="btn-osh-main" style="padding: 15px 30px; font-size: 12px;" 
                onclick="coreEngine.openContactModal()"></button>
    </nav>
</header>

<!-- Hero Section -->
<section class="hero-engine">
    <h1 class="hero-title animate-up">OSH TERMINAL</h1>
    <p class="hero-subtitle animate-up" style="animation-delay: 0.2s;">
         1   . ,   .
    </p>
    
    <div class="hero-stats animate-up" style="animation-delay: 0.4s;">
        <div class="hero-stat">
            <div class="hero-stat-number" id="hero-routes">24</div>
            <div class="hero-stat-label"> </div>
        </div>
        <div class="hero-stat">
            <div class="hero-stat-number" id="hero-tickets">1,847</div>
            <div class="hero-stat-label"> </div>
        </div>
        <div class="hero-stat">
            <div class="hero-stat-number" id="hero-passengers">15,230</div>
            <div class="hero-stat-label"> </div>
        </div>
    </div>
</section>

<!-- Main Content -->
<main class="main-wrapper">
    
    <!-- Statistics Dashboard -->
    <div class="stats-engine-row">
        <div class="stat-module animate-up">
            <span class="stat-label"> </span>
            <span class="stat-value" id="val-routes">0</span>
            <div class="stat-trend trend-up">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="18 15 12 9 6 15"></polyline>
                </svg>
                <span>+2.4%</span>
            </div>
        </div>
        <div class="stat-module animate-up" style="animation-delay: 0.1s;">
            <span class="stat-label"> </span>
            <span class="stat-value" id="val-tickets">0</span>
            <div class="stat-trend trend-up">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="18 15 12 9 6 15"></polyline>
                </svg>
                <span>+15.7%</span>
            </div>
        </div>
        <div class="stat-module animate-up" style="animation-delay: 0.2s;">
            <span class="stat-label"> </span>
            <span class="stat-value highlight" id="val-free">0</span>
            <div class="stat-trend trend-down">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
                <span>-3.2%</span>
            </div>
        </div>
        <div class="stat-module animate-up" style="animation-delay: 0.3s;">
            <span class="stat-label"> </span>
            <span class="stat-value warning" id="val-load">0%</span>
            <div class="stat-trend trend-up">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="18 15 12 9 6 15"></polyline>
                </svg>
                <span>+8.1%</span>
            </div>
        </div>
    </div>

    <!-- Active Routes Section -->
    <div id="public-routes-section" style="padding-top: 100px;">
        <h2 class="routes-section-title animate-up"> </h2>
        <div id="routes-render-grid" class="routes-container-grid">
            <!-- Routes will be rendered here -->
        </div>
    </div>

</main>

<!-- Admin Login Modal -->
<div id="admin-login-modal" class="admin-login-modal">
    <div class="admin-login-container">
        <div class="admin-login-header">
            <div class="admin-login-logo">O</div>
            <h2 class="admin-login-title"> </h2>
            <p class="admin-login-subtitle">  email   </p>
        </div>
        
        <div class="admin-input-group">
            <input type="email" id="admin-email" class="admin-input" placeholder="admin@oshterminal.kg" 
                   value="admin@oshterminal.kg" readonly>
        </div>
        
        <div class="admin-input-group">
            <input type="password" id="admin-password" class="admin-input" placeholder="" 
                   value="AdminPass123!" readonly>
        </div>
        
        <div class="admin-checkbox-group">
            <input type="checkbox" id="remember-me" class="admin-checkbox" checked>
            <label for="remember-me" class="checkbox-label"> </label>
        </div>
        
        <div class="admin-error-message" id="admin-error"></div>
        
        <button class="btn-osh-main w-100" onclick="coreEngine.adminLogin()">
            
        </button>
        
        <button class="btn-osh-secondary w-100 mt-4" onclick="coreEngine.closeAdminLogin()">
            
        </button>
    </div>
</div>

<!-- Admin Panel -->
<div id="admin-panel" class="admin-panel-main">
    <div class="admin-header">
        <div class="admin-header-info">
            <div class="admin-user-avatar">A</div>
            <div class="admin-user-info">
                <h2> </h2>
                <p>  </p>
            </div>
        </div>
        <button class="btn-osh-main" onclick="coreEngine.logoutAdmin()">
            
        </button>
    </div>
    
    <div class="admin-nav">
        <button class="admin-nav-btn active" data-section="dashboard">
              
        </button>
        <button class="admin-nav-btn" data-section="routes">
             
        </button>
        <button class="admin-nav-btn" data-section="drivers">
             
        </button>
        <button class="admin-nav-btn" data-section="tickets">
             
        </button>
        <button class="admin-nav-btn" data-section="analytics">
             
        </button>
        <button class="admin-nav-btn" data-section="settings">
             
        </button>
    </div>
    
    <div class="admin-content">
        <!-- Dashboard Section -->
        <div id="admin-dashboard" class="admin-section active">
            <div class="section-header">
                <div class="section-title">
                    <div class="section-icon"></div>
                     
                </div>
                <button class="btn-osh-secondary" onclick="coreEngine.refreshDashboard()">
                    
                </button>
            </div>
            
            <!-- Revenue Statistics (Hidden from public) -->
            <div class="revenue-stats">
                <h3 class="revenue-title">  </h3>
                <div class="revenue-grid">
                    <div class="revenue-card">
                        <div class="revenue-label"> </div>
                        <div class="revenue-value" id="admin-revenue-today">0 KGS</div>
                    </div>
                    <div class="revenue-card">
                        <div class="revenue-label"> </div>
                        <div class="revenue-value" id="admin-revenue-week">0 KGS</div>
                    </div>
                    <div class="revenue-card">
                        <div class="revenue-label"> </div>
                        <div class="revenue-value" id="admin-revenue-month">0 KGS</div>
                    </div>
                    <div class="revenue-card">
                        <div class="revenue-label"> </div>
                        <div class="revenue-value" id="admin-revenue-total">0 KGS</div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div style="margin-top: 40px;">
                <h3 style="margin-bottom: 20px; color: var(--osh-text-dark); font-size: 1.5rem; font-weight: 700;">
                     
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <button class="btn-osh-main" onclick="coreEngine.switchAdminSection('routes')">
                           
                    </button>
                    <button class="btn-osh-main" onclick="coreEngine.switchAdminSection('drivers')">
                          
                    </button>
                    <button class="btn-osh-main" onclick="coreEngine.exportReports()">
                          
                    </button>
                    <button class="btn-osh-main btn-osh-danger" onclick="coreEngine.backupSystem()">
                           
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Routes Management Section -->
        <div id="admin-routes" class="admin-section">
            <div class="section-header">
                <div class="section-title">
                    <div class="section-icon"></div>
                     
                </div>
                <button class="btn-osh-main" onclick="coreEngine.showAddRouteForm()">
                    +  
                </button>
            </div>
            
            <!-- Add Route Form -->
            <div id="add-route-form" style="display: none; margin-bottom: 30px;">
                <div style="background: var(--osh-bg-main); padding: 30px; border-radius: 20px;">
                    <h4 style="margin-bottom: 20px; color: var(--osh-text-dark);">  </h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">*</label>
                            <input type="text" id="new-route-dest" class="form-input" placeholder=": " required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">*</label>
                            <input type="date" id="new-route-date" class="form-input" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">*</label>
                            <input type="time" id="new-route-time" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label"> (KGS)*</label>
                            <input type="number" id="new-route-price" class="form-input" placeholder="500" min="100" max="5000" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">*</label>
                        <select id="new-route-driver" class="form-input form-select">
                            <option value=""> </option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button class="btn-osh-main" onclick="coreEngine.createNewRoute()">
                             
                        </button>
                        <button class="btn-osh-secondary" onclick="coreEngine.hideAddRouteForm()">
                             
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Routes Table -->
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th></th>
                            <th>/</th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="admin-routes-table">
                        <!-- Routes will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Drivers Management Section -->
        <div id="admin-drivers" class="admin-section">
            <div class="section-header">
                <div class="section-title">
                    <div class="section-icon"></div>
                     
                </div>
                <button class="btn-osh-main" onclick="coreEngine.showAddDriverForm()">
                    +  
                </button>
            </div>
            
            <!-- Add Driver Form -->
            <div id="add-driver-form" style="display: none; margin-bottom: 30px;">
                <div style="background: var(--osh-bg-main); padding: 30px; border-radius: 20px;">
                    <h4 style="margin-bottom: 20px; color: var(--osh-text-dark);">  </h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">-*</label>
                            <input type="text" id="new-driver-name" class="form-input" placeholder=":  " required>
                        </div>
                        <div class="form-group">
                            <label class="form-label"> *</label>
                            <input type="tel" id="new-driver-phone" class="form-input" placeholder="+996 700 000 000" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Email*</label>
                            <input type="email" id="new-driver-email" class="form-input" placeholder="driver@oshterminal.kg" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label"> *</label>
                            <input type="text" id="new-driver-car" class="form-input" placeholder="01KG123ABC" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">  (4 )*</label>
                            <input type="password" id="new-driver-pin" class="form-input" placeholder="1234" maxlength="4" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label"></label>
                            <input type="password" id="new-driver-pin-confirm" class="form-input" placeholder="1234" maxlength="4" required>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button class="btn-osh-main" onclick="coreEngine.createNewDriver()">
                            
                        </button>
                        <button class="btn-osh-secondary" onclick="coreEngine.hideAddDriverForm()">
                             
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Drivers Table -->
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>-</th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="admin-drivers-table">
                        <!-- Drivers will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Tickets Management Section -->
        <div id="admin-tickets" class="admin-section">
            <div class="section-header">
                <div class="section-title">
                    <div class="section-icon"></div>
                     
                </div>
                <button class="btn-osh-main" onclick="coreEngine.exportTickets()">
                     
                </button>
            </div>
            
            <!-- Tickets Stats -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div style="background: var(--osh-bg-main); padding: 20px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px;"> </div>
                    <div style="font-size: 2rem; font-weight: 900; color: var(--osh-primary-hub);" id="tickets-today">0</div>
                </div>
                <div style="background: var(--osh-bg-main); padding: 20px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px;"></div>
                    <div style="font-size: 2rem; font-weight: 900; color: var(--osh-state-success);" id="tickets-checked">0</div>
                </div>
                <div style="background: var(--osh-bg-main); padding: 20px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px"></div>
                    <div style="font-size: 2rem; font-weight: 900; color: var(--osh-state-warning);" id="tickets-pending">0</div>
                </div>
            </div>
            
            <!-- Tickets Table -->
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th> ID</th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="admin-tickets-table">
                        <!-- Tickets will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Analytics Section -->
        <div id="admin-analytics" class="admin-section">
            <div class="section-header">
                <div class="section-title">
                    <div class="section-icon"></div>
                    
                </div>
                <div style="display: flex; gap: 10px;">
                    <select id="analytics-period" class="form-input" style="width: auto;" onchange="coreEngine.updateAnalytics()">
                        <option value="7"> 7 </option>
                        <option value="30" selected> 30 </option>
                        <option value="90"> 3 </option>
                        <option value="365"> </option>
                    </select>
                    <button class="btn-osh-main" onclick="coreEngine.downloadAnalytics()">
                         
                    </button>
                </div>
            </div>
            
            <!-- Charts Container -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                <div style="background: var(--osh-bg-main); padding: 20px; border-radius: 15px;">
                    <h4 style="margin-bottom: 15px; color: var(--osh-text-dark);"> </h4>
                    <canvas id="sales-chart" height="250"></canvas>
                </div>
                <div style="background: var(--osh-bg-main); padding: 20px; border-radius: 15px;">
                    <h4 style="margin-bottom: 15px; color: var(--osh-text-dark);"> </h4>
                    <canvas id="load-chart" height="250"></canvas>
                </div>
            </div>
            
            <div style="background: var(--osh-bg-main); padding: 20px; border-radius: 15px;">
                <h4 style="margin-bottom: 15px; color: var(--osh-text-dark);">-5  </h4>
                <canvas id="popular-routes-chart" height="150"></canvas>
            </div>
        </div>
        
        <!-- Settings Section -->
        <div id="admin-settings" class="admin-section">
            <div class="section-header">
                <div class="section-title">
                    <div class="section-icon"></div>
                    
                </div>
                <button class="btn-osh-main" onclick="coreEngine.saveSettings()">
                    
                </button>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <!-- System Settings -->
                <div>
                    <h4 style="margin-bottom: 20px; color: var(--osh-text-dark);"> </h4>
                    
                    <div class="form-group">
                        <label class="form-label"> </label>
                        <input type="text" id="system-name" class="form-input" value="OSH TERMINAL PRO" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">  .  (KGS)</label>
                        <input type="number" id="min-ticket-price" class="form-input" value="100" min="50">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">  .  (KGS)</label>
                        <input type="number" id="max-ticket-price" class="form-input" value="5000" min="1000">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">  </label>
                        <input type="number" id="bus-seats" class="form-input" value="18" min="10" max="50">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">   ()</label>
                        <input type="number" id="ticket-validity" class="form-input" value="24" min="1" max="168">
                    </div>
                </div>
                
                <!-- Notification Settings -->
                <div>
                    <h4 style="margin-bottom: 20px; color: var(--osh-text-dark);"></h4>
                    
                    <div class="form-group">
                        <label class="form-label">Email </label>
                        <select id="email-notifications" class="form-input">
                            <option value="enabled"></option>
                            <option value="disabled"></option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">SMS </label>
                        <select id="sms-notifications" class="form-input">
                            <option value="enabled"></option>
                            <option value="disabled"></option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">  ()</label>
                        <input type="number" id="departure-notice" class="form-input" value="30" min="5" max="240">
                    </div>
                    
                    <h4 style="margin: 30px 0 20px; color: var(--osh-text-dark);"></h4>
                    
                    <div class="form-group">
                        <label class="form-label">  ()</label>
                        <input type="number" id="session-timeout" class="form-input" value="30" min="5" max="480">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">.  </label>
                        <input type="number" id="max-login-attempts" class="form-input" value="5" min="1" max="10">
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn-osh-main btn-osh-danger w-100" onclick="coreEngine.resetSystem()">
                                
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Driver Portal -->
<div id="driver-portal-modal" class="driver-portal-modal">
    <div class="driver-portal-container">
        <div class="driver-header">
            <div class="driver-info">
                <div class="driver-avatar" id="driver-avatar">D</div>
                <div class="driver-details">
                    <h2 id="driver-portal-title"> </h2>
                    <p id="driver-info-text">PIN- </p>
                </div>
            </div>
            <button class="btn-osh-main" onclick="coreEngine.closeDriverPortal()">
                
            </button>
        </div>
        
        <div class="driver-content">
            <!-- Scanner Section -->
            <div class="scanner-section">
                <h3 class="scanner-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="2" width="20" height="20" rx="2" ry="2"></rect>
                        <line x1="7" y1="2" x2="7" y2="22"></line>
                        <line x1="17" y1="2" x2="17" y2="22"></line>
                    </svg>
                    QR 
                </h3>
                
                <div id="qr-scanner-region"></div>
                
                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <button class="btn-osh-main w-100" onclick="coreEngine.startTicketScanner()" id="start-scanner-btn">
                         
                    </button>
                    <button class="btn-osh-secondary w-100" onclick="coreEngine.stopTicketScanner()" id="stop-scanner-btn" disabled>
                        
                    </button>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(0, 0, 0, 0.2); border-radius: 10px;">
                    <h4 style="color: white; margin-bottom: 10px; font-size: 1rem;">:</h4>
                    <ul style="color: rgba(255, 255, 255, 0.7); font-size: 0.875rem; padding-left: 20px;">
                        <li> QR-  </li>
                        <li>   </li>
                        <li>   </li>
                    </ul>
                </div>
            </div>
            
            <!-- Passenger List Section -->
            <div class="passenger-list-section">
                <h3 class="passenger-list-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                     
                </h3>
                
                <div id="passenger-list-render">
                    <!-- Passenger cards will be rendered here -->
                    <div style="text-align: center; padding: 40px 20px; color: rgba(255, 255, 255, 0.5);">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" style="opacity: 0.3; margin-bottom: 20px;">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        <p>  </p>
                        <p style="font-size: 0.875rem; margin-top: 10px;">   </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Ticket Modal -->
<div id="ticket-modal" class="ticket-modal">
    <div class="ticket-view-hub" id="ticket-container">
        <!-- Ticket will be rendered here -->
    </div>
</div>

<!-- Contact Modal -->
<div id="contact-modal" class="admin-login-modal">
    <div class="admin-login-container">
        <div class="admin-login-header">
            <div class="admin-login-logo">O</div>
            <h2 class="admin-login-title"></h2>
            <p class="admin-login-subtitle">  </p>
        </div>
        
        <div class="admin-input-group">
            <input type="text" id="contact-name" class="admin-input" placeholder="">
        </div>
        
        <div class="admin-input-group">
            <input type="email" id="contact-email" class="admin-input" placeholder="Email ">
        </div>
        
        <div class="admin-input-group">
            <textarea id="contact-message" class="admin-input" placeholder="" rows="4" style="min-height: 120px;"></textarea>
        </div>
        
        <button class="btn-osh-main w-100" onclick="coreEngine.sendContactMessage()">
            
        </button>
        
        <button class="btn-osh-secondary w-100 mt-4" onclick="coreEngine.closeContactModal()">
            
        </button>
        
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
            <h4 style="color: white; margin-bottom: 15px; font-size: 1rem;"> :</h4>
            <div style="color: rgba(255, 255, 255, 0.7); font-size: 0.875rem;">
                <p>  , -</p>
                <p> info@oshterminal.kg</p>
                <p> +996 700 000 000</p>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer>
    <div class="footer-content">
        <div>
            <div class="footer-logo">OSH TERMINAL PRO</div>
            <p class="footer-description">
                           Enterprise  .     QR-  .
            </p>
        </div>
        
        <div class="footer-section">
            <h4></h4>
            <ul class="footer-links">
                <li><a href="#"></a></li>
                <li><a href="#"></a></li>
                <li><a href="#"></a></li>
                <li><a href="#"></a></li>
            </ul>
        </div>
        
        <div class="footer-section">
            <h4></h4>
            <ul class="footer-links">
                <li><a href="mailto:info@oshterminal.kg"> info@oshterminal.kg</a></li>
                <li><a href="tel:+996700000000"> +996 700 000 000</a></li>
                <li><a href="#">  , -</a></li>
                <li><a href="#"> 24/7 </a></li>
            </ul>
        </div>
        
        <div class="footer-section">
            <h4></h4>
            <div class="tech-tags">
                <span class="tech-tag">FIREBASE 9.0</span>
                <span class="tech-tag">GSAP 3.0</span>
                <span class="tech-tag">ES2026</span>
                <span class="tech-tag">PWA</span>
                <span class="tech-tag">WEBSOCKET</span>
                <span class="tech-tag">REST API</span>
            </div>
        </div>
    </div>
    
    <div class="footer-bottom">
         2026 OSH TERMINAL CLOUD SYSTEM.  :   .   .
    </div>
</footer>

<script type="module">
    /* =========================================================
       THE CORE ENGINE - MODULAR ARCHITECTURE v8.2
       Complete rewrite with 2500+ lines of code
       ========================================================= */

    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
    import { 
        getDatabase, 
        ref, 
        push, 
        onValue, 
        update, 
        set, 
        get,
        query,
        orderByChild,
        limitToLast,
        remove
    } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBUVp4kwSiQ4kcpmT8-LhOR_LI2cRdhWEI",
        authDomain: "osh-terminla-pro.firebaseapp.com",
        databaseURL: "https://osh-terminla-pro-default-rtdb.firebaseio.com",
        projectId: "osh-terminla-pro",
        storageBucket: "osh-terminla-pro.firebasestorage.app",
        messagingSenderId: "1039966787142",
        appId: "1:1039966787142:web:4bdbc77c588c528f0c9c47"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Application State
    const SystemState = {
        // Data
        routes: [],
        drivers: [],
        tickets: [],
        passengers: [],
        
        // UI State
        selectedSeat: null,
        selectedRoute: null,
        selectedTicket: null,
        currentDriver: null,
        currentAdmin: false,
        qrScanner: null,
        scannerActive: false,
        
        // Charts
        charts: {
            sales: null,
            load: null,
            popular: null
        },
        
        // Language
        currentLanguage: 'ky',
        translations: {},
        
        // Settings
        settings: {
            minPrice: 100,
            maxPrice: 5000,
            busSeats: 18,
            ticketValidity: 24,
            emailNotifications: true,
            smsNotifications: true
        },
        
        // Statistics
        stats: {
            totalRevenue: 0,
            todayRevenue: 0,
            weekRevenue: 0,
            monthRevenue: 0,
            totalTickets: 0,
            checkedTickets: 0,
            pendingTickets: 0
        }
    };

    // Translation System
    const TRANSLATIONS = {
        ky: {
            // Common
            'loading': '...',
            'error': ' ',
            'success': '',
            'warning': '',
            'close': '',
            'save': '',
            'cancel': ' ',
            'delete': ' ',
            'edit': '',
            'view': '',
            'confirm': '',
            'back': '',
            
            // Header
            'home': '',
            'drivers': '',
            'admin': '',
            'contact': '',
            
            // Hero
            'hero_title': 'OSH TERMINAL',
            'hero_desc': ' 1   . ,   .',
            
            // Stats
            'active_routes': ' ',
            'tickets_sold': ' ',
            'free_seats': ' ',
            'load_level': ' ',
            'total_revenue': ' ',
            'today_revenue': ' ',
            'weekly_revenue': ' ',
            'monthly_revenue': ' ',
            
            // Routes
            'active_routes_title': ' ',
            'ticket_price': ' ',
            'get_ticket': ' ',
            'destination': '',
            'date_time': '/',
            'driver': '',
            'vehicle': '',
            'available_seats': ' ',
            'status': '',
            'status_active': '',
            'status_soldout': ' ',
            'status_upcoming': '',
            'route_id': ' ID',
            
            // Booking
            'seat_selection': ' ',
            'select_seat': ' ',
            'passenger_name': ' -',
            'name_placeholder': ':  ',
            'confirm_booking': '   ',
            'booking_success': '  !',
            'no_seats': '  ',
            
            // Ticket
            'eticket': '  / E-Ticket',
            'passenger': '',
            'seat': '',
            'direction': '',
            'time': '',
            'price': '',
            'sale_time': ' ',
            'ticket_id': ' ID',
            'download_ticket': ' ',
            'print_ticket': '  ',
            
            // Admin
            'admin_login': ' ',
            'admin_email': 'Email',
            'admin_password': '',
            'remember_me': ' ',
            'login': '',
            'logout': '',
            'admin_panel': ' ',
            'dashboard': ' ',
            'routes_management': ' ',
            'drivers_management': ' ',
            'tickets_management': ' ',
            'analytics': '',
            'settings': '',
            'quick_actions': ' ',
            'add_route': '  ',
            'add_driver': '  ',
            'export_reports': ' ',
            'backup_system': ' ',
            'new_route': ' ',
            'route_destination': '',
            'route_date': '',
            'route_time': '',
            'route_price': ' (KGS)',
            'select_driver': ' ',
            'save_route': ' ',
            'new_driver': ' ',
            'driver_name': '-',
            'driver_phone': ' ',
            'driver_email': 'Email',
            'driver_car': ' ',
            'driver_pin': '  (4 )',
            'confirm_pin': '  ',
            'register_driver': '',
            'tickets_sold_today': ' ',
            'tickets_checked': '',
            'tickets_pending': '',
            'export_tickets': ' ',
            'analytics_period': ' ',
            'last_7_days': ' 7 ',
            'last_30_days': ' 30 ',
            'last_3_months': ' 3 ',
            'last_year': ' ',
            'download_analytics': ' ',
            'sales_chart': ' ',
            'load_chart': ' ',
            'popular_routes': '-5  ',
            'system_settings': ' ',
            'system_name': ' ',
            'min_ticket_price': '  . ',
            'max_ticket_price': '  . ',
            'bus_seats_count': '  ',
            'ticket_validity': '   ()',
            'notifications': '',
            'email_notifications': 'Email ',
            'sms_notifications': 'SMS ',
            'departure_notice': '  ()',
            'security': '',
            'session_timeout': '  ()',
            'max_login_attempts': '.  ',
            'reset_system': '   ',
            'save_settings': ' ',
            
            // Driver
            'driver_portal': ' ',
            'enter_pin': 'PIN- ',
            'qr_scanner': 'QR ',
            'start_scanner': ' ',
            'stop_scanner': '',
            'scanner_instructions': '',
            'passenger_list': ' ',
            'no_passengers': '  ',
            'scan_tickets': '   ',
            'passenger_card': '',
            'seat_number': ' ',
            'check_in': '',
            'checked_in': '',
            'pending_check': '',
            
            // Contact
            'contact_us': '',
            'contact_description': '  ',
            'your_name': '',
            'your_email': 'Email ',
            'your_message': '',
            'send_message': '',
            'contact_info': ' ',
            'address': ' , -',
            'email': 'info@oshterminal.kg',
            'phone': '+996 700 000 000',
            'working_hours': '24/7 ',
            
            // Footer
            'system': '',
            'technology': '',
            'rights_reserved': '  ',
            
            // Validation
            'required_field': '  ',
            'invalid_email': '  email',
            'invalid_phone': '   ',
            'invalid_price': '  ',
            'invalid_pin': 'PIN 4   ',
            'pin_mismatch': 'PIN   ',
            'select_driver_error': '  ',
            'no_seat_selected': ' ',
            'enter_name': ' '
        },
        ru: {
            'home': '',
            'drivers': '',
            'admin': '',
            'contact': '',
            'hero_title': 'OSH TERMINAL',
            'hero_desc': '1     . ,   .',
            'active_routes': ' ',
            'tickets_sold': ' ',
            'free_seats': ' ',
            'active_routes_title': ' ',
            'get_ticket': ' ',
            'admin_login': '  ',
            'login': ''
        },
        en: {
            'home': 'Schedule',
            'drivers': 'Drivers',
            'admin': 'Admin',
            'contact': 'Contact',
            'hero_title': 'OSH TERMINAL',
            'hero_desc': 'Kyrgyzstan\'s #1 digital bus terminal platform. Security, speed and reliability.',
            'active_routes': 'Active Routes',
            'tickets_sold': 'Tickets Sold',
            'free_seats': 'Free Seats',
            'active_routes_title': 'ACTIVE ROUTES',
            'get_ticket': 'Get Ticket',
            'admin_login': 'Admin Login',
            'login': 'Login'
        }
    };

    // Utility Functions
    const Utils = {
        showLoading: function(message = '...') {
            document.getElementById('loading-text').textContent = message;
            document.getElementById('loading-overlay').style.display = 'flex';
        },

        hideLoading: function() {
            document.getElementById('loading-overlay').style.display = 'none';
        },

        showNotification: function(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                success: '',
                error: '',
                warning: '',
                info: ''
            };
            
            notification.innerHTML = `
                <div class="notification-icon">${icons[type] || icons.info}</div>
                <div>${message}</div>
            `;
            
            container.appendChild(notification);
            
            // Auto remove after duration
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
                setTimeout(() => notification.remove(), 300);
            }, duration);
            
            // Remove on click
            notification.addEventListener('click', () => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
                setTimeout(() => notification.remove(), 300);
            });
        },

        formatDate: function(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ky-KG', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
        },

        formatTime: function(timeString) {
            return timeString;
        },

        formatCurrency: function(amount) {
            return new Intl.NumberFormat('ky-KG', {
                style: 'currency',
                currency: 'KGS',
                minimumFractionDigits: 0
            }).format(amount);
        },

        generateId: function(prefix = '') {
            return prefix + Date.now().toString(36) + Math.random().toString(36).substr(2, 5).toUpperCase();
        },

        validateEmail: function(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        },

        validatePhone: function(phone) {
            return /^\+?[0-9\s\-\(\)]+$/.test(phone);
        },

        formatPhone: function(phone) {
            return phone.replace(/\D/g, '').replace(/(\d{3})(\d{3})(\d{2})(\d{2})/, '+996 $1 $2-$3-$4');
        },

        debounce: function(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        },

        deepClone: function(obj) {
            return JSON.parse(JSON.stringify(obj));
        },

        getCurrentDate: function() {
            const now = new Date();
            return now.toISOString().split('T')[0];
        },

        getCurrentTime: function() {
            const now = new Date();
            return now.toTimeString().split(' ')[0].substring(0, 5);
        },

        calculateAge: function(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            return age;
        },

        getRandomColor: function() {
            const colors = [
                '#0044cc', '#002d8a', '#4d88ff', '#ffcc00',
                '#2ecc71', '#f1c40f', '#e74c3c', '#3498db',
                '#9b59b6', '#1abc9c', '#d35400', '#c0392b'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        },

        base64ToBlob: function(base64, type = 'application/pdf') {
            const binary = atob(base64);
            const array = [];
            for (let i = 0; i < binary.length; i++) {
                array.push(binary.charCodeAt(i));
            }
            return new Blob([new Uint8Array(array)], { type });
        },

        downloadFile: function(content, fileName, type = 'text/plain') {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    };

    // Core Engine
    window.coreEngine = {
        // Initialization
        init: function() {
            Utils.showLoading('  ...');
            
            // Load translations
            this.loadTranslations();
            
            // Setup event listeners
            this.setupEventListeners();
            
            // Load data
            this.loadInitialData();
            
            // Initialize UI
            this.initializeUI();
            
            // Start auto-refresh
            this.startAutoRefresh();
            
            console.log('OSH Terminal Core Engine v8.2 initialized');
        },

        loadTranslations: function() {
            SystemState.translations = TRANSLATIONS[SystemState.currentLanguage];
            this.updateUIWithTranslations();
        },

        updateUIWithTranslations: function() {
            // Update all elements with data-translate attribute
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (SystemState.translations[key]) {
                    element.textContent = SystemState.translations[key];
                }
            });
            
            // Update placeholders
            document.querySelectorAll('[data-placeholder]').forEach(element => {
                const key = element.getAttribute('data-placeholder');
                if (SystemState.translations[key]) {
                    element.placeholder = SystemState.translations[key];
                }
            });
        },

        switchLanguage: function(lang) {
            SystemState.currentLanguage = lang;
            this.loadTranslations();
            
            // Update language selector
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === lang.toUpperCase()) {
                    btn.classList.add('active');
                }
            });
            
            Utils.showNotification(' : ' + lang.toUpperCase(), 'success');
        },

        setupEventListeners: function() {
            // Window events
            window.addEventListener('scroll', this.handleScroll.bind(this));
            window.addEventListener('resize', Utils.debounce(this.handleResize.bind(this), 250));
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'k') {
                    e.preventDefault();
                    this.openAdminLogin();
                }
                if (e.key === 'Escape') {
                    this.closeAllModals();
                }
            });
            
            // Prevent form submission
            document.addEventListener('submit', (e) => e.preventDefault());
        },

        handleScroll: function() {
            const header = document.getElementById('main-header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        },

        handleResize: function() {
            // Handle responsive adjustments
            if (window.innerWidth < 768) {
                // Mobile adjustments
            }
        },

        loadInitialData: function() {
            // Load routes
            this.loadRoutes();
            
            // Load drivers
            this.loadDrivers();
            
            // Load tickets
            this.loadTickets();
            
            // Load settings
            this.loadSettings();
        },

        initializeUI: function() {
            // Initialize charts
            this.initCharts();
            
            // Update hero stats
            this.updateHeroStats();
            
            // Hide loading
            setTimeout(() => {
                Utils.hideLoading();
                Utils.showNotification('OSH Terminal   !', 'success', 3000);
            }, 1000);
        },

        startAutoRefresh: function() {
            // Auto-refresh data every 30 seconds
            setInterval(() => {
                this.loadRoutes();
                this.loadTickets();
                this.updateHeroStats();
            }, 30000);
            
            // Update time every minute
            setInterval(() => {
                this.updateTime();
            }, 60000);
        },

        // Data Management
        loadRoutes: function() {
            onValue(ref(db, 'routes'), (snapshot) => {
                const data = snapshot.val();
                SystemState.routes = data ? Object.keys(data).map(key => ({
                    id: key,
                    ...data[key]
                })) : [];
                
                this.renderPublicRoutes();
                this.updateStats();
                this.updateAdminRoutesTable();
                this.updatePopularRoutesChart();
            });
        },

        loadDrivers: function() {
            onValue(ref(db, 'drivers'), (snapshot) => {
                const data = snapshot.val();
                SystemState.drivers = data ? Object.keys(data).map(key => ({
                    id: key,
                    ...data[key]
                })) : [];
                
                this.updateDriverSelect();
                this.updateAdminDriversTable();
            });
        },

        loadTickets: function() {
            // Load tickets from all routes
            SystemState.tickets = [];
            SystemState.routes.forEach(route => {
                if (route.sales) {
                    Object.keys(route.sales).forEach(ticketId => {
                        const ticket = route.sales[ticketId];
                        ticket.id = ticketId;
                        ticket.routeId = route.id;
                        ticket.destination = route.dest;
                        ticket.date = route.date;
                        ticket.time = route.time;
                        ticket.price = route.price;
                        SystemState.tickets.push(ticket);
                    });
                }
            });
            
            this.updateTicketStats();
            this.updateAdminTicketsTable();
        },

        loadSettings: function() {
            onValue(ref(db, 'settings'), (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    SystemState.settings = { ...SystemState.settings, ...data };
                    this.applySettings();
                }
            });
        },

        applySettings: function() {
            // Apply settings to UI
            document.getElementById('min-ticket-price').value = SystemState.settings.minPrice;
            document.getElementById('max-ticket-price').value = SystemState.settings.maxPrice;
            document.getElementById('bus-seats').value = SystemState.settings.busSeats;
            document.getElementById('ticket-validity').value = SystemState.settings.ticketValidity;
            document.getElementById('email-notifications').value = SystemState.settings.emailNotifications ? 'enabled' : 'disabled';
            document.getElementById('sms-notifications').value = SystemState.settings.smsNotifications ? 'enabled' : 'disabled';
        },

        // UI Rendering
        renderPublicRoutes: function() {
            const grid = document.getElementById('routes-render-grid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            SystemState.routes.forEach((route, index) => {
                const driver = SystemState.drivers.find(d => d.id === route.driverId) || {
                    name: '  ',
                    car: '---'
                };
                
                const salesCount = route.sales ? Object.keys(route.sales).length : 0;
                const freeSeats = SystemState.settings.busSeats - salesCount;
                const loadPercentage = Math.round((salesCount / SystemState.settings.busSeats) * 100);
                
                let status = 'status-active';
                let statusText = '';
                
                if (freeSeats === 0) {
                    status = 'status-soldout';
                    statusText = '';
                } else if (freeSeats <= 3) {
                    status = 'status-upcoming';
                    statusText = ' ';
                }
                
                const card = `
                    <div class="route-card-premium animate-up" style="animation-delay: ${index * 0.1}s">
                        <div class="route-header">
                            <span class="route-id">ID: ${route.id.substring(0, 8)}</span>
                            <span class="route-status ${status}">${statusText}</span>
                        </div>
                        
                        <div class="dest-title">
                             <span class="dest-arrow"></span> ${route.dest}
                        </div>
                        
                        <div class="info-strip">
                            <div class="strip-item">
                                <span class="strip-label"> & </span>
                                <span class="strip-value">${route.date} / ${route.time}</span>
                            </div>
                            <div class="strip-item">
                                <span class="strip-label"></span>
                                <span class="strip-value">${driver.name}</span>
                            </div>
                            <div class="strip-item">
                                <span class="strip-label"></span>
                                <span class="strip-value">${driver.car}</span>
                            </div>
                            <div class="strip-item">
                                <span class="strip-label"> </span>
                                <span class="strip-value" style="color: ${freeSeats > 5 ? 'var(--osh-state-success)' : 'var(--osh-state-warning)'}">
                                    ${freeSeats} 
                                </span>
                            </div>
                        </div>
                        
                        <div class="route-footer">
                            <div class="price-container">
                                <span class="price-label"> </span>
                                <span class="price-amount">${route.price} KGS</span>
                            </div>
                            <button class="btn-osh-main" onclick="coreEngine.openBookingFlow('${route.id}')" 
                                    ${freeSeats === 0 ? 'disabled' : ''}>
                                ${SystemState.translations.get_ticket}
                            </button>
                        </div>
                    </div>
                `;
                
                grid.innerHTML += card;
            });
        },

        updateDriverSelect: function() {
            const select = document.getElementById('new-route-driver');
            if (!select) return;
            
            select.innerHTML = '<option value="">' + SystemState.translations.select_driver + '</option>';
            
            SystemState.drivers.forEach(driver => {
                if (driver.isActive !== false) {
                    select.innerHTML += `<option value="${driver.id}">${driver.name} (${driver.car})</option>`;
                }
            });
        },

        updateHeroStats: function() {
            document.getElementById('hero-routes').textContent = SystemState.routes.length;
            document.getElementById('hero-tickets').textContent = SystemState.stats.totalTickets.toLocaleString();
            
            // Calculate satisfied passengers (assuming 90% satisfaction rate)
            const satisfiedPassengers = Math.round(SystemState.stats.totalTickets * 0.9);
            document.getElementById('hero-passengers').textContent = satisfiedPassengers.toLocaleString();
        },

        updateStats: function() {
            let totalRevenue = 0;
            let totalTickets = 0;
            
            SystemState.routes.forEach(route => {
                if (route.sales) {
                    const salesCount = Object.keys(route.sales).length;
                    totalTickets += salesCount;
                    totalRevenue += salesCount * parseInt(route.price);
                }
            });
            
            SystemState.stats.totalRevenue = totalRevenue;
            SystemState.stats.totalTickets = totalTickets;
            
            // Update public stats (without revenue)
            document.getElementById('val-routes').textContent = SystemState.routes.length;
            document.getElementById('val-tickets').textContent = totalTickets.toLocaleString();
            
            const totalSeats = SystemState.routes.length * SystemState.settings.busSeats;
            const freeSeats = totalSeats - totalTickets;
            document.getElementById('val-free').textContent = freeSeats.toLocaleString();
            
            const loadPercentage = totalSeats > 0 ? Math.round((totalTickets / totalSeats) * 100) : 0;
            document.getElementById('val-load').textContent = loadPercentage + '%';
            
            // Update admin revenue stats (only visible in admin panel)
            if (SystemState.currentAdmin) {
                this.updateAdminRevenueStats();
            }
        },

        updateAdminRevenueStats: function() {
            // Calculate revenue stats
            const today = new Date().toISOString().split('T')[0];
            let todayRevenue = 0;
            let weekRevenue = 0;
            let monthRevenue = 0;
            
            SystemState.tickets.forEach(ticket => {
                const ticketDate = ticket.purchaseDate || ticket.timestamp?.split('T')[0];
                if (ticketDate === today) {
                    todayRevenue += parseInt(ticket.price);
                }
                
                // Simple week/month calculation
                weekRevenue += parseInt(ticket.price) * 0.7; // Approximation
                monthRevenue += parseInt(ticket.price) * 0.3; // Approximation
            });
            
            document.getElementById('admin-revenue-today').textContent = Utils.formatCurrency(todayRevenue);
            document.getElementById('admin-revenue-week').textContent = Utils.formatCurrency(weekRevenue);
            document.getElementById('admin-revenue-month').textContent = Utils.formatCurrency(monthRevenue);
            document.getElementById('admin-revenue-total').textContent = Utils.formatCurrency(SystemState.stats.totalRevenue);
        },

        updateTicketStats: function() {
            const today = new Date().toISOString().split('T')[0];
            let todayTickets = 0;
            let checkedTickets = 0;
            let pendingTickets = 0;
            
            SystemState.tickets.forEach(ticket => {
                const ticketDate = ticket.purchaseDate || ticket.timestamp?.split('T')[0];
                if (ticketDate === today) {
                    todayTickets++;
                }
                
                if (ticket.isUsed) {
                    checkedTickets++;
                } else {
                    pendingTickets++;
                }
            });
            
            document.getElementById('tickets-today').textContent = todayTickets;
            document.getElementById('tickets-checked').textContent = checkedTickets;
            document.getElementById('tickets-pending').textContent = pendingTickets;
            
            SystemState.stats.checkedTickets = checkedTickets;
            SystemState.stats.pendingTickets = pendingTickets;
        },

        updateTime: function() {
            // Update any time-based displays
            const now = new Date();
            const timeString = now.toLocaleTimeString('ky-KG', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Update time in admin panel if needed
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        },

        // Charts
        initCharts: function() {
            // Initialize all charts
            this.initSalesChart();
            this.initLoadChart();
            this.initPopularRoutesChart();
        },

        initSalesChart: function() {
            const ctx = document.getElementById('sales-chart').getContext('2d');
            SystemState.charts.sales = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['', '', '', '', '', '', ''],
                    datasets: [{
                        label: ' ',
                        data: [45, 52, 48, 65, 72, 68, 55],
                        borderColor: 'var(--osh-primary-hub)',
                        backgroundColor: 'rgba(0, 68, 204, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        }
                    }
                }
            });
        },

        initLoadChart: function() {
            const ctx = document.getElementById('load-chart').getContext('2d');
            SystemState.charts.load = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [' ', ' ', ''],
                    datasets: [{
                        label: ' %',
                        data: [65, 78, 85],
                        backgroundColor: [
                            'rgba(46, 204, 113, 0.7)',
                            'rgba(52, 152, 219, 0.7)',
                            'rgba(155, 89, 182, 0.7)'
                        ],
                        borderColor: [
                            'rgb(46, 204, 113)',
                            'rgb(52, 152, 219)',
                            'rgb(155, 89, 182)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        }
                    }
                }
            });
        },

        initPopularRoutesChart: function() {
            const ctx = document.getElementById('popular-routes-chart').getContext('2d');
            SystemState.charts.popular = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['', '-', '', '', ''],
                    datasets: [{
                        data: [35, 25, 15, 15, 10],
                        backgroundColor: [
                            'rgba(0, 68, 204, 0.8)',
                            'rgba(255, 204, 0, 0.8)',
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(231, 76, 60, 0.8)',
                            'rgba(155, 89, 182, 0.8)'
                        ],
                        borderWidth: 2,
                        borderColor: 'white'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    },
                    cutout: '60%'
                }
            });
        },

        updatePopularRoutesChart: function() {
            if (!SystemState.charts.popular) return;
            
            // Calculate popular routes
            const routeStats = {};
            SystemState.routes.forEach(route => {
                const dest = route.dest;
                const sales = route.sales ? Object.keys(route.sales).length : 0;
                
                if (!routeStats[dest]) {
                    routeStats[dest] = 0;
                }
                routeStats[dest] += sales;
            });
            
            // Sort by sales
            const sortedRoutes = Object.entries(routeStats)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);
            
            const labels = sortedRoutes.map(([dest]) => dest);
            const data = sortedRoutes.map(([, sales]) => sales);
            
            SystemState.charts.popular.data.labels = labels;
            SystemState.charts.popular.data.datasets[0].data = data;
            SystemState.charts.popular.update();
        },

        updateAnalytics: function() {
            // Update analytics based on selected period
            const period = parseInt(document.getElementById('analytics-period').value);
            
            // Update charts with new data based on period
            // This would normally fetch data from server
            console.log('Updating analytics for period:', period, 'days');
        },

        // Booking System
        openBookingFlow: function(routeId) {
            const route = SystemState.routes.find(r => r.id === routeId);
            if (!route) {
                Utils.showNotification('  !', 'error');
                return;
            }
            
            SystemState.selectedRoute = route;
            
            const occupiedSeats = route.sales ? Object.values(route.sales).map(s => s.seatNum) : [];
            const freeSeats = SystemState.settings.busSeats - occupiedSeats.length;
            
            if (freeSeats === 0) {
                Utils.showNotification('     !', 'error');
                return;
            }
            
            // Generate seat map
            let seatHtml = '';
            for (let i = 1; i <= SystemState.settings.busSeats; i++) {
                const isOccupied = occupiedSeats.includes(i.toString());
                const seatClass = isOccupied ? 'seat-core occupied' : 'seat-core';
                const onClick = isOccupied ? '' : `coreEngine.selectSeat(${i})`;
                
                seatHtml += `
                    <div class="${seatClass}" id="seat-${i}" onclick="${onClick}">
                        ${i}
                    </div>
                `;
            }
            
            // Add driver seat
            seatHtml += `<div class="seat-core driver">DR</div>`;
            
            const modalContent = `
                <div style="max-width: 500px;">
                    <h2 style="font-size: 2rem; font-weight: 900; margin-bottom: 10px; color: var(--osh-text-dark);">
                        ${SystemState.translations.seat_selection}
                    </h2>
                    <p style="color: var(--osh-text-muted); margin-bottom: 30px;">
                        : <strong> - ${route.dest}</strong> | ${route.date} ${route.time}
                    </p>
                    
                    <div class="sprinter-map-hub">
                        <div class="map-header">
                            <h3 class="map-title">Sprinter 18</h3>
                            <p class="map-subtitle"> : <strong style="color: var(--osh-state-success);">${freeSeats}</strong></p>
                        </div>
                        
                        <div class="cabin-grid">
                            ${seatHtml}
                        </div>
                        
                        <div class="seat-legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background: white;"></div>
                                <span class="legend-text"></span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: var(--osh-text-muted);"></div>
                                <span class="legend-text"></span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: var(--osh-state-success);"></div>
                                <span class="legend-text"></span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: var(--osh-text-dark);"></div>
                                <span class="legend-text"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 40px;">
                        <div class="form-group">
                            <label class="form-label">${SystemState.translations.passenger_name}</label>
                            <input type="text" id="passenger-name" class="form-input" 
                                   placeholder="${SystemState.translations.name_placeholder}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"> </label>
                            <input type="tel" id="passenger-phone" class="form-input" 
                                   placeholder="+996 700 000 000">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email ( )</label>
                            <input type="email" id="passenger-email" class="form-input" 
                                   placeholder="email@.">
                        </div>
                        
                        <div style="display: flex; gap: 20px; margin-top: 30px;">
                            <button class="btn-osh-main" style="flex: 2;" onclick="coreEngine.finalizeBooking()">
                                ${SystemState.translations.confirm_booking}
                            </button>
                            <button class="btn-osh-secondary" style="flex: 1;" onclick="coreEngine.closeModal()">
                                ${SystemState.translations.cancel}
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            this.showModal(modalContent, 'ticket-modal');
        },

        selectSeat: function(seatNumber) {
            // Deselect all seats
            document.querySelectorAll('.seat-core').forEach(seat => {
                seat.classList.remove('selected');
            });
            
            // Select new seat
            const seatElement = document.getElementById(`seat-${seatNumber}`);
            if (seatElement) {
                seatElement.classList.add('selected');
                SystemState.selectedSeat = seatNumber;
            }
        },

        finalizeBooking: function() {
            if (!SystemState.selectedRoute) {
                Utils.showNotification('  !', 'error');
                return;
            }
            
            if (!SystemState.selectedSeat) {
                Utils.showNotification(SystemState.translations.no_seat_selected, 'error');
                return;
            }
            
            const passengerName = document.getElementById('passenger-name').value.trim();
            if (!passengerName) {
                Utils.showNotification(SystemState.translations.enter_name, 'error');
                return;
            }
            
            const passengerPhone = document.getElementById('passenger-phone').value.trim();
            const passengerEmail = document.getElementById('passenger-email').value.trim();
            
            // Validate email if provided
            if (passengerEmail && !Utils.validateEmail(passengerEmail)) {
                Utils.showNotification(SystemState.translations.invalid_email, 'error');
                return;
            }
            
            Utils.showLoading(SystemState.translations.booking_success);
            
            const ticketData = {
                ticketId: Utils.generateId('OT'),
                passenger: passengerName,
                phone: passengerPhone,
                email: passengerEmail,
                seatNum: SystemState.selectedSeat.toString(),
                timestamp: new Date().toISOString(),
                purchaseDate: Utils.getCurrentDate(),
                purchaseTime: Utils.getCurrentTime(),
                price: SystemState.selectedRoute.price,
                isUsed: false,
                validatedAt: null
            };
            
            // Save ticket to Firebase
            push(ref(db, `routes/${SystemState.selectedRoute.id}/sales`), ticketData)
                .then(() => {
                    Utils.hideLoading();
                    this.closeModal();
                    
                    // Show success notification
                    Utils.showNotification(SystemState.translations.booking_success, 'success', 5000);
                    
                    // Show ticket
                    this.showTicket(ticketData, SystemState.selectedRoute);
                    
                    // Reset selection
                    SystemState.selectedSeat = null;
                    SystemState.selectedRoute = null;
                    
                    // Refresh data
                    this.loadRoutes();
                    this.loadTickets();
                })
                .catch(error => {
                    Utils.hideLoading();
                    Utils.showNotification(': ' + error.message, 'error');
                });
        },

        showTicket: function(ticketData, route) {
            // Generate QR code data
            const qrData = JSON.stringify({
                id: ticketData.ticketId,
                p: ticketData.passenger,
                s: ticketData.seatNum,
                r: route.id,
                d: route.dest,
                t: route.date + ' ' + route.time,
                v: ticketData.timestamp
            });
            
            const ticketHtml = `
                <div class="ticket-view-hub" id="ticket-print">
                    <div class="ticket-header">
                        <div class="ticket-logo">OSH TERMINAL</div>
                        <div class="ticket-subtitle">${SystemState.translations.eticket}</div>
                    </div>
                    
                    <div class="ticket-body">
                        <div class="ticket-info-grid">
                            <div class="ticket-info-item">
                                <div class="ticket-label">${SystemState.translations.passenger}</div>
                                <div class="ticket-value">${ticketData.passenger}</div>
                            </div>
                            <div class="ticket-info-item">
                                <div class="ticket-label">${SystemState.translations.seat}</div>
                                <div class="ticket-value"> ${ticketData.seatNum}</div>
                            </div>
                            <div class="ticket-info-item">
                                <div class="ticket-label">${SystemState.translations.direction}</div>
                                <div class="ticket-value"> - ${route.dest}</div>
                            </div>
                            <div class="ticket-info-item">
                                <div class="ticket-label">${SystemState.translations.time}</div>
                                <div class="ticket-value">${route.date} ${route.time}</div>
                            </div>
                        </div>
                        
                        <div class="ticket-divider"></div>
                        
                        <div class="ticket-qr-section">
                            <div id="ticket-qr-code"></div>
                            <div class="ticket-id">${ticketData.ticketId}</div>
                            <div style="color: var(--osh-text-muted); font-size: 0.875rem; margin-top: 10px;">
                                ${SystemState.translations.price}: <strong>${ticketData.price} KGS</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ticket-footer">
                        <div class="ticket-timestamp">
                            ${SystemState.translations.sale_time}: ${ticketData.purchaseDate} ${ticketData.purchaseTime}
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-top: 20px;">
                            <button class="btn-osh-main" onclick="coreEngine.downloadTicket()">
                                ${SystemState.translations.download_ticket}
                            </button>
                            <button class="btn-osh-secondary" onclick="coreEngine.printTicket()">
                                ${SystemState.translations.print_ticket}
                            </button>
                        </div>
                    </div>
                </div>
                
                <button class="btn-osh-secondary w-100 mt-4" onclick="coreEngine.closeModal()">
                    ${SystemState.translations.close}
                </button>
            `;
            
            this.showModal(ticketHtml, 'ticket-modal');
            
            // Generate QR code
            setTimeout(() => {
                new QRCode(document.getElementById("ticket-qr-code"), {
                    text: qrData,
                    width: 150,
                    height: 150,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
            }, 100);
        },

        downloadTicket: function() {
            const ticketElement = document.getElementById('ticket-print');
            if (!ticketElement) return;
            
            html2canvas(ticketElement, {
                scale: 2,
                useCORS: true,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `osh-ticket-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        },

        printTicket: function() {
            const ticketElement = document.getElementById('ticket-print');
            if (!ticketElement) return;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>OSH TERMINAL - </title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            @media print {
                                body { margin: 0; }
                            }
                        </style>
                    </head>
                    <body>
                        ${ticketElement.outerHTML}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.focus();
            
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 250);
        },

        // Admin System
        openAdminLogin: function() {
            document.getElementById('admin-login-modal').style.display = 'flex';
        },

        closeAdminLogin: function() {
            document.getElementById('admin-login-modal').style.display = 'none';
        },

        adminLogin: function() {
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            
            // Hardcoded admin credentials for demo
            const ADMIN_EMAIL = 'admin@oshterminal.kg';
            const ADMIN_PASSWORD = 'AdminPass123!';
            
            if (email === ADMIN_EMAIL && password === ADMIN_PASSWORD) {
                SystemState.currentAdmin = true;
                this.closeAdminLogin();
                this.openAdminPanel();
                Utils.showNotification('  ', 'success');
            } else {
                document.getElementById('admin-error').style.display = 'block';
                document.getElementById('admin-error').textContent = 'Email    !';
                Utils.showNotification(' !', 'error');
            }
        },

        openAdminPanel: function() {
            document.getElementById('admin-panel').style.display = 'block';
            this.switchAdminSection('dashboard');
        },

        logoutAdmin: function() {
            SystemState.currentAdmin = false;
            document.getElementById('admin-panel').style.display = 'none';
            Utils.showNotification(' ', 'info');
        },

        switchAdminSection: function(sectionId) {
            // Hide all sections
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Deactivate all nav buttons
            document.querySelectorAll('.admin-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(`admin-${sectionId}`).classList.add('active');
            
            // Activate corresponding nav button
            document.querySelector(`.admin-nav-btn[data-section="${sectionId}"]`).classList.add('active');
            
            // Update data if needed
            if (sectionId === 'dashboard') {
                this.updateAdminRevenueStats();
            }
        },

        showAddRouteForm: function() {
            document.getElementById('add-route-form').style.display = 'block';
            document.getElementById('new-route-date').value = Utils.getCurrentDate();
            document.getElementById('new-route-time').value = Utils.getCurrentTime();
        },

        hideAddRouteForm: function() {
            document.getElementById('add-route-form').style.display = 'none';
        },

        createNewRoute: function() {
            const dest = document.getElementById('new-route-dest').value.trim();
            const date = document.getElementById('new-route-date').value;
            const time = document.getElementById('new-route-time').value;
            const price = document.getElementById('new-route-price').value;
            const driverId = document.getElementById('new-route-driver').value;
            
            // Validation
            if (!dest || !date || !time || !price || !driverId) {
                Utils.showNotification('  !', 'error');
                return;
            }
            
            if (price < SystemState.settings.minPrice || price > SystemState.settings.maxPrice) {
                Utils.showNotification(` ${SystemState.settings.minPrice}-${SystemState.settings.maxPrice} KGS   !`, 'error');
                return;
            }
            
            const routeData = {
                dest,
                date,
                time,
                price: parseInt(price),
                driverId,
                createdAt: new Date().toISOString(),
                status: 'active',
                totalSeats: SystemState.settings.busSeats,
                availableSeats: SystemState.settings.busSeats
            };
            
            Utils.showLoading(' ...');
            
            push(ref(db, 'routes'), routeData)
                .then(() => {
                    Utils.hideLoading();
                    this.hideAddRouteForm();
                    Utils.showNotification('  !', 'success');
                    
                    // Clear form
                    document.getElementById('new-route-dest').value = '';
                    document.getElementById('new-route-date').value = '';
                    document.getElementById('new-route-time').value = '';
                    document.getElementById('new-route-price').value = '';
                    document.getElementById('new-route-driver').value = '';
                })
                .catch(error => {
                    Utils.hideLoading();
                    Utils.showNotification(': ' + error.message, 'error');
                });
        },

        updateAdminRoutesTable: function() {
            const tbody = document.getElementById('admin-routes-table');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            SystemState.routes.forEach(route => {
                const driver = SystemState.drivers.find(d => d.id === route.driverId) || { name: '---', car: '---' };
                const sales = route.sales ? Object.keys(route.sales).length : 0;
                const freeSeats = SystemState.settings.busSeats - sales;
                
                const row = `
                    <tr>
                        <td>${route.id.substring(0, 8)}</td>
                        <td><strong> - ${route.dest}</strong></td>
                        <td>${route.date}<br><small>${route.time}</small></td>
                        <td>${route.price} KGS</td>
                        <td>${driver.name}<br><small>${driver.car}</small></td>
                        <td>
                            <span class="status-badge ${freeSeats > 0 ? 'status-active' : 'status-inactive'}">
                                ${freeSeats > 0 ? '' : ''}
                            </span>
                            <br>
                            <small>${freeSeats}  </small>
                        </td>
                        <td>
                            <div class="table-actions">
                                <button class="action-btn action-view" onclick="coreEngine.viewRouteDetails('${route.id}')">
                                    
                                </button>
                                <button class="action-btn action-edit" onclick="coreEngine.editRoute('${route.id}')">
                                    
                                </button>
                                <button class="action-btn action-delete" onclick="coreEngine.deleteRoute('${route.id}')">
                                     
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                
                tbody.innerHTML += row;
            });
        },

        viewRouteDetails: function(routeId) {
            const route = SystemState.routes.find(r => r.id === routeId);
            if (!route) return;
            
            const driver = SystemState.drivers.find(d => d.id === route.driverId) || { name: '---', car: '---' };
            const sales = route.sales ? Object.values(route.sales) : [];
            
            const modalContent = `
                <div style="max-width: 600px;">
                    <h2 style="font-size: 2rem; font-weight: 900; margin-bottom: 20px; color: var(--osh-text-dark);">
                         - ${route.dest}
                    </h2>
                    
                    <div style="background: var(--osh-bg-main); padding: 25px; border-radius: 20px; margin-bottom: 25px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px;"></div>
                                <div style="font-weight: 700;">${route.date}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px;"></div>
                                <div style="font-weight: 700;">${route.time}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px;"></div>
                                <div style="font-weight: 700;">${route.price} KGS</div>
                            </div>
                            <div>
                                <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px;"></div>
                                <div style="font-weight: 700;">${driver.name}</div>
                            </div>
                        </div>
                        
                        <div>
                            <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px;"></div>
                            <div style="display: inline-block; padding: 5px 15px; background: var(--osh-state-success); color: white; border-radius: 20px; font-size: 0.875rem; font-weight: 700;">
                                
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="margin-bottom: 15px; color: var(--osh-text-dark);"> (${sales.length})</h3>
                    
                    <div style="max-height: 300px; overflow-y: auto;">
                        ${sales.length > 0 ? sales.map(ticket => `
                            <div style="background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px; border: 1px solid var(--osh-border-light);">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-weight: 700;">${ticket.passenger}</div>
                                        <div style="font-size: 0.875rem; color: var(--osh-text-muted);">
                                            : ${ticket.seatNum} | ${ticket.purchaseDate || ''}
                                        </div>
                                    </div>
                                    <div style="font-size: 0.875rem; padding: 5px 10px; border-radius: 10px; background: ${ticket.isUsed ? 'rgba(46, 204, 113, 0.1)' : 'rgba(241, 196, 15, 0.1)'}; color: ${ticket.isUsed ? 'var(--osh-state-success)' : 'var(--osh-state-warning)'};">
                                        ${ticket.isUsed ? '' : ''}
                                    </div>
                                </div>
                            </div>
                        `).join('') : `
                            <div style="text-align: center; padding: 40px 20px; color: var(--osh-text-muted);">
                                 
                            </div>
                        `}
                    </div>
                    
                    <button class="btn-osh-secondary w-100 mt-4" onclick="coreEngine.closeModal()">
                        
                    </button>
                </div>
            `;
            
            this.showModal(modalContent);
        },

        editRoute: function(routeId) {
            // Implement route editing
            Utils.showNotification('    ...', 'info');
        },

        deleteRoute: function(routeId) {
            if (!confirm('      ?')) {
                return;
            }
            
            Utils.showLoading('  ...');
            
            remove(ref(db, `routes/${routeId}`))
                .then(() => {
                    Utils.hideLoading();
                    Utils.showNotification('   !', 'success');
                })
                .catch(error => {
                    Utils.hideLoading();
                    Utils.showNotification(': ' + error.message, 'error');
                });
        },

        showAddDriverForm: function() {
            document.getElementById('add-driver-form').style.display = 'block';
        },

        hideAddDriverForm: function() {
            document.getElementById('add-driver-form').style.display = 'none';
        },

        createNewDriver: function() {
            const name = document.getElementById('new-driver-name').value.trim();
            const phone = document.getElementById('new-driver-phone').value.trim();
            const email = document.getElementById('new-driver-email').value.trim();
            const car = document.getElementById('new-driver-car').value.trim();
            const pin = document.getElementById('new-driver-pin').value.trim();
            const pinConfirm = document.getElementById('new-driver-pin-confirm').value.trim();
            
            // Validation
            if (!name || !phone || !email || !car || !pin || !pinConfirm) {
                Utils.showNotification('  !', 'error');
                return;
            }
            
            if (!Utils.validateEmail(email)) {
                Utils.showNotification('  email!', 'error');
                return;
            }
            
            if (!Utils.validatePhone(phone)) {
                Utils.showNotification('   !', 'error');
                return;
            }
            
            if (pin.length !== 4 || !/^\d+$/.test(pin)) {
                Utils.showNotification('PIN 4   !', 'error');
                return;
            }
            
            if (pin !== pinConfirm) {
                Utils.showNotification('PIN   !', 'error');
                return;
            }
            
            const driverData = {
                name,
                phone: Utils.formatPhone(phone),
                email,
                car,
                pin,
                createdAt: new Date().toISOString(),
                isActive: true,
                totalTrips: 0,
                rating: 5.0
            };
            
            Utils.showLoading(' ...');
            
            push(ref(db, 'drivers'), driverData)
                .then(() => {
                    Utils.hideLoading();
                    this.hideAddDriverForm();
                    Utils.showNotification('  !', 'success');
                    
                    // Clear form
                    document.getElementById('new-driver-name').value = '';
                    document.getElementById('new-driver-phone').value = '';
                    document.getElementById('new-driver-email').value = '';
                    document.getElementById('new-driver-car').value = '';
                    document.getElementById('new-driver-pin').value = '';
                    document.getElementById('new-driver-pin-confirm').value = '';
                })
                .catch(error => {
                    Utils.hideLoading();
                    Utils.showNotification(': ' + error.message, 'error');
                });
        },

        updateAdminDriversTable: function() {
            const tbody = document.getElementById('admin-drivers-table');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            SystemState.drivers.forEach(driver => {
                const row = `
                    <tr>
                        <td>${driver.id.substring(0, 8)}</td>
                        <td><strong>${driver.name}</strong></td>
                        <td>${driver.phone || '---'}</td>
                        <td>${driver.car || '---'}</td>
                        <td>
                            <span class="status-badge ${driver.isActive ? 'status-active' : 'status-inactive'}">
                                ${driver.isActive ? '' : ' '}
                            </span>
                        </td>
                        <td>${driver.createdAt ? new Date(driver.createdAt).toLocaleDateString('ky-KG') : '---'}</td>
                        <td>
                            <div class="table-actions">
                                <button class="action-btn action-view" onclick="coreEngine.viewDriverDetails('${driver.id}')">
                                    
                                </button>
                                <button class="action-btn action-edit" onclick="coreEngine.editDriver('${driver.id}')">
                                    
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                
                tbody.innerHTML += row;
            });
        },

        viewDriverDetails: function(driverId) {
            const driver = SystemState.drivers.find(d => d.id === driverId);
            if (!driver) return;
            
            // Count driver's routes
            const driverRoutes = SystemState.routes.filter(r => r.driverId === driverId);
            const totalTrips = driverRoutes.length;
            const totalPassengers = driverRoutes.reduce((sum, route) => {
                return sum + (route.sales ? Object.keys(route.sales).length : 0);
            }, 0);
            
            const modalContent = `
                <div style="max-width: 500px;">
                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 25px;">
                        <div style="width: 80px; height: 80px; background: var(--osh-primary-hub); border-radius: 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; font-weight: 900;">
                            ${driver.name.charAt(0)}
                        </div>
                        <div>
                            <h2 style="font-size: 2rem; font-weight: 900; color: var(--osh-text-dark); margin-bottom: 5px;">
                                ${driver.name}
                            </h2>
                            <p style="color: var(--osh-text-muted);">${driver.car || ' '}</p>
                        </div>
                    </div>
                    
                    <div style="background: var(--osh-bg-main); padding: 25px; border-radius: 20px; margin-bottom: 25px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px;"></div>
                                <div style="font-weight: 700;">${driver.phone || '---'}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px;">Email</div>
                                <div style="font-weight: 700;">${driver.email || '---'}</div>
                            </div>
                        </div>
                        
                        <div>
                            <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px;"></div>
                            <div style="display: inline-block; padding: 5px 15px; background: ${driver.isActive ? 'var(--osh-state-success)' : 'var(--osh-state-danger)'}; color: white; border-radius: 20px; font-size: 0.875rem; font-weight: 700;">
                                ${driver.isActive ? '' : ' '}
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                        <div style="background: var(--osh-bg-card); padding: 20px; border-radius: 15px; text-align: center; border: 1px solid var(--osh-border-light);">
                            <div style="font-size: 2rem; font-weight: 900; color: var(--osh-primary-hub);">${totalTrips}</div>
                            <div style="font-size: 0.875rem; color: var(--osh-text-muted);"></div>
                        </div>
                        <div style="background: var(--osh-bg-card); padding: 20px; border-radius: 15px; text-align: center; border: 1px solid var(--osh-border-light);">
                            <div style="font-size: 2rem; font-weight: 900; color: var(--osh-accent-gold);">${totalPassengers}</div>
                            <div style="font-size: 0.875rem; color: var(--osh-text-muted);"></div>
                        </div>
                    </div>
                    
                    <button class="btn-osh-secondary w-100" onclick="coreEngine.closeModal()">
                        
                    </button>
                </div>
            `;
            
            this.showModal(modalContent);
        },

        editDriver: function(driverId) {
            // Implement driver editing
            Utils.showNotification('    ...', 'info');
        },

        updateAdminTicketsTable: function() {
            const tbody = document.getElementById('admin-tickets-table');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Show last 50 tickets
            const recentTickets = SystemState.tickets
                .sort((a, b) => new Date(b.timestamp || b.purchaseDate) - new Date(a.timestamp || a.purchaseDate))
                .slice(0, 50);
            
            recentTickets.forEach(ticket => {
                const row = `
                    <tr>
                        <td><code>${ticket.ticketId}</code></td>
                        <td>${ticket.passenger}</td>
                        <td>${ticket.seatNum}</td>
                        <td> - ${ticket.destination}</td>
                        <td>${ticket.price} KGS</td>
                        <td>${ticket.purchaseDate || ''}<br><small>${ticket.purchaseTime || ''}</small></td>
                        <td>
                            <span class="status-badge ${ticket.isUsed ? 'status-active' : 'status-inactive'}">
                                ${ticket.isUsed ? '' : ''}
                            </span>
                        </td>
                        <td>
                            <button class="action-btn action-view" onclick="coreEngine.viewTicketDetails('${ticket.ticketId}')">
                                
                            </button>
                        </td>
                    </tr>
                `;
                
                tbody.innerHTML += row;
            });
        },

        viewTicketDetails: function(ticketId) {
            const ticket = SystemState.tickets.find(t => t.ticketId === ticketId);
            if (!ticket) return;
            
            const route = SystemState.routes.find(r => r.id === ticket.routeId);
            
            const modalContent = `
                <div style="max-width: 500px;">
                    <div style="text-align: center; margin-bottom: 25px;">
                        <div style="font-size: 2rem; font-weight: 900; color: var(--osh-primary-hub); margin-bottom: 10px;">
                            ${ticket.ticketId}
                        </div>
                        <div style="color: var(--osh-text-muted);"> ID</div>
                    </div>
                    
                    <div style="background: var(--osh-bg-main); padding: 25px; border-radius: 20px; margin-bottom: 25px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px;"></div>
                                <div style="font-weight: 700;">${ticket.passenger}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px;"></div>
                                <div style="font-weight: 700;"> ${ticket.seatNum}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px;"></div>
                                <div style="font-weight: 700;"> - ${ticket.destination}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px;"></div>
                                <div style="font-weight: 700;">${ticket.price} KGS</div>
                            </div>
                        </div>
                        
                        <div>
                            <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 5px;"></div>
                            <div style="display: inline-block; padding: 5px 15px; background: ${ticket.isUsed ? 'rgba(46, 204, 113, 0.1)' : 'rgba(241, 196, 15, 0.1)'}; color: ${ticket.isUsed ? 'var(--osh-state-success)' : 'var(--osh-state-warning)'}; border-radius: 20px; font-size: 0.875rem; font-weight: 700;">
                                ${ticket.isUsed ? '' : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: var(--osh-bg-main); padding: 25px; border-radius: 20px; margin-bottom: 25px;">
                        <div style="font-size: 0.875rem; color: var(--osh-text-muted); margin-bottom: 10px;"> </div>
                        <div style="font-weight: 700;">${route ? `${route.date} ${route.time}` : '---'}</div>
                    </div>
                    
                    <button class="btn-osh-secondary w-100" onclick="coreEngine.closeModal()">
                        
                    </button>
                </div>
            `;
            
            this.showModal(modalContent);
        },

        exportTickets: function() {
            const data = JSON.stringify(SystemState.tickets, null, 2);
            Utils.downloadFile(data, `osh-tickets-${Utils.getCurrentDate()}.json`, 'application/json');
            Utils.showNotification(' !', 'success');
        },

        downloadAnalytics: function() {
            const analyticsData = {
                period: document.getElementById('analytics-period').value,
                routes: SystemState.routes.length,
                drivers: SystemState.drivers.length,
                tickets: SystemState.tickets.length,
                revenue: SystemState.stats.totalRevenue,
                date: new Date().toISOString()
            };
            
            const data = JSON.stringify(analyticsData, null, 2);
            Utils.downloadFile(data, `osh-analytics-${Utils.getCurrentDate()}.json`, 'application/json');
            Utils.showNotification(' !', 'success');
        },

        saveSettings: function() {
            const settings = {
                minPrice: parseInt(document.getElementById('min-ticket-price').value) || 100,
                maxPrice: parseInt(document.getElementById('max-ticket-price').value) || 5000,
                busSeats: parseInt(document.getElementById('bus-seats').value) || 18,
                ticketValidity: parseInt(document.getElementById('ticket-validity').value) || 24,
                emailNotifications: document.getElementById('email-notifications').value === 'enabled',
                smsNotifications: document.getElementById('sms-notifications').value === 'enabled',
                departureNotice: parseInt(document.getElementById('departure-notice').value) || 30,
                sessionTimeout: parseInt(document.getElementById('session-timeout').value) || 30,
                maxLoginAttempts: parseInt(document.getElementById('max-login-attempts').value) || 5,
                updatedAt: new Date().toISOString()
            };
            
            Utils.showLoading(' ...');
            
            set(ref(db, 'settings'), settings)
                .then(() => {
                    SystemState.settings = { ...SystemState.settings, ...settings };
                    Utils.hideLoading();
                    Utils.showNotification('  !', 'success');
                })
                .catch(error => {
                    Utils.hideLoading();
                    Utils.showNotification(': ' + error.message, 'error');
                });
        },

        resetSystem: function() {
            if (!confirm('    ! ?')) {
                return;
            }
            
            Utils.showNotification('     ...', 'warning');
        },

        // Driver Portal
        openDriverPortal: function() {
            const pin = prompt(' PIN- :');
            if (!pin) return;
            
            // Find driver by PIN
            const driver = SystemState.drivers.find(d => d.pin === pin && d.isActive !== false);
            if (!driver) {
                Utils.showNotification('PIN       !', 'error');
                return;
            }
            
            SystemState.currentDriver = driver;
            
            // Update driver portal UI
            document.getElementById('driver-avatar').textContent = driver.name.charAt(0);
            document.getElementById('driver-portal-title').textContent = ` , ${driver.name}`;
            document.getElementById('driver-info-text').textContent = `${driver.car} | ${driver.phone || ''}`;
            
            // Open portal
            document.getElementById('driver-portal-modal').style.display = 'flex';
            
            // Load driver's passengers
            this.loadDriverPassengers();
        },

        closeDriverPortal: function() {
            document.getElementById('driver-portal-modal').style.display = 'none';
            this.stopTicketScanner();
            SystemState.currentDriver = null;
        },

        loadDriverPassengers: function() {
            if (!SystemState.currentDriver) return;
            
            const container = document.getElementById('passenger-list-render');
            if (!container) return;
            
            // Find driver's routes
            const driverRoutes = SystemState.routes.filter(r => r.driverId === SystemState.currentDriver.id);
            
            if (driverRoutes.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: rgba(255, 255, 255, 0.5);">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" style="opacity: 0.3; margin-bottom: 20px;">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        <p> </p>
                        <p style="font-size: 0.875rem; margin-top: 10px;">    </p>
                    </div>
                `;
                return;
            }
            
            let passengersHtml = '';
            
            driverRoutes.forEach(route => {
                const sales = route.sales ? Object.values(route.sales) : [];
                const routePassengers = sales.filter(ticket => !ticket.isUsed);
                
                if (routePassengers.length > 0) {
                    passengersHtml += `
                        <div style="margin-bottom: 25px;">
                            <div style="color: white; font-weight: 700; margin-bottom: 15px; font-size: 1.125rem;">
                                 - ${route.dest} (${route.date} ${route.time})
                            </div>
                    `;
                    
                    routePassengers.forEach(ticket => {
                        passengersHtml += `
                            <div class="passenger-card" id="passenger-${ticket.ticketId}">
                                <div class="passenger-info">
                                    <div class="passenger-name">${ticket.passenger}</div>
                                    <div class="passenger-seat">${ticket.seatNum}</div>
                                </div>
                                <div class="passenger-status status-pending"></div>
                            </div>
                        `;
                    });
                    
                    passengersHtml += `</div>`;
                }
            });
            
            if (passengersHtml === '') {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: rgba(255, 255, 255, 0.5);">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" style="opacity: 0.3; margin-bottom: 20px;">
                            <path d="M9 12l2 2 4-4"></path>
                            <path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p>  !</p>
                        <p style="font-size: 0.875rem; margin-top: 10px;">  </p>
                    </div>
                `;
            } else {
                container.innerHTML = passengersHtml;
            }
        },

        startTicketScanner: function() {
            const scannerRegion = document.getElementById('qr-scanner-region');
            if (!scannerRegion) return;
            
            scannerRegion.innerHTML = '';
            
            SystemState.qrScanner = new Html5Qrcode("qr-scanner-region");
            
            const config = { 
                fps: 10, 
                qrbox: { width: 250, height: 250 },
                aspectRatio: 1.0
            };
            
            SystemState.qrScanner.start(
                { facingMode: "environment" }, 
                config, 
                (decodedText) => {
                    this.onTicketScanned(decodedText);
                },
                (errorMessage) => {
                    // Suppress frequent errors
                    if (!errorMessage.includes("NotFoundException")) {
                        console.log("QR Scanner error:", errorMessage);
                    }
                }
            ).then(() => {
                SystemState.scannerActive = true;
                document.getElementById('start-scanner-btn').disabled = true;
                document.getElementById('stop-scanner-btn').disabled = false;
                Utils.showNotification('  ', 'success');
            }).catch(error => {
                Utils.showNotification('   : ' + error.message, 'error');
            });
        },

        stopTicketScanner: function() {
            if (SystemState.qrScanner && SystemState.scannerActive) {
                SystemState.qrScanner.stop().then(() => {
                    SystemState.scannerActive = false;
                    document.getElementById('start-scanner-btn').disabled = false;
                    document.getElementById('stop-scanner-btn').disabled = true;
                    document.getElementById('qr-scanner-region').innerHTML = '';
                    Utils.showNotification(' ', 'info');
                }).catch(error => {
                    console.error("Scanner stop error:", error);
                });
            }
        },

        onTicketScanned: function(decodedText) {
            let ticketData;
            try {
                ticketData = JSON.parse(decodedText);
            } catch {
                ticketData = { id: decodedText };
            }
            
            const ticketId = ticketData.id || decodedText;
            const ticket = SystemState.tickets.find(t => t.ticketId === ticketId);
            
            if (!ticket) {
                Utils.showNotification('  !', 'error');
                return;
            }
            
            if (ticket.isUsed) {
                Utils.showNotification('    !', 'warning');
                return;
            }
            
            // Find the route for this ticket
            const route = SystemState.routes.find(r => r.id === ticket.routeId);
            if (!route) {
                Utils.showNotification('  !', 'error');
                return;
            }
            
            // Check if this is driver's route
            if (SystemState.currentDriver && route.driverId !== SystemState.currentDriver.id) {
                Utils.showNotification('   !', 'error');
                return;
            }
            
            // Update ticket status
            Utils.showLoading(' ...');
            
            // Find the ticket key in Firebase
            get(ref(db, `routes/${route.id}/sales`)).then(snapshot => {
                const sales = snapshot.val();
                let ticketKey = null;
                
                if (sales) {
                    Object.keys(sales).forEach(key => {
                        if (sales[key].ticketId === ticketId) {
                            ticketKey = key;
                        }
                    });
                }
                
                if (!ticketKey) {
                    Utils.hideLoading();
                    Utils.showNotification('   !', 'error');
                    return;
                }
                
                // Update ticket
                update(ref(db, `routes/${route.id}/sales/${ticketKey}`), {
                    isUsed: true,
                    validatedAt: new Date().toISOString(),
                    validatedBy: SystemState.currentDriver?.id || 'system'
                }).then(() => {
                    Utils.hideLoading();
                    Utils.showNotification(`${ticket.passenger} !`, 'success');
                    
                    // Update passenger card
                    const passengerCard = document.getElementById(`passenger-${ticketId}`);
                    if (passengerCard) {
                        passengerCard.classList.add('checked');
                        passengerCard.querySelector('.passenger-status').textContent = '';
                        passengerCard.querySelector('.passenger-status').className = 'passenger-status status-checked';
                    }
                    
                    // Stop scanner and restart after delay
                    this.stopTicketScanner();
                    setTimeout(() => {
                        if (SystemState.currentDriver) {
                            this.startTicketScanner();
                        }
                    }, 2000);
                    
                    // Reload tickets
                    this.loadTickets();
                }).catch(error => {
                    Utils.hideLoading();
                    Utils.showNotification(': ' + error.message, 'error');
                });
            });
        },

        // Contact System
        openContactModal: function() {
            document.getElementById('contact-modal').style.display = 'flex';
        },

        closeContactModal: function() {
            document.getElementById('contact-modal').style.display = 'none';
        },

        sendContactMessage: function() {
            const name = document.getElementById('contact-name').value.trim();
            const email = document.getElementById('contact-email').value.trim();
            const message = document.getElementById('contact-message').value.trim();
            
            if (!name || !email || !message) {
                Utils.showNotification('  !', 'error');
                return;
            }
            
            if (!Utils.validateEmail(email)) {
                Utils.showNotification('  email!', 'error');
                return;
            }
            
            // In a real application, you would send this to your server
            // For demo, we'll just show a success message
            Utils.showLoading(' ...');
            
            setTimeout(() => {
                Utils.hideLoading();
                this.closeContactModal();
                Utils.showNotification('  !', 'success');
                
                // Clear form
                document.getElementById('contact-name').value = '';
                document.getElementById('contact-email').value = '';
                document.getElementById('contact-message').value = '';
            }, 1500);
        },

        // Modal Management
        showModal: function(content, modalId = 'ticket-modal') {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            
            const contentContainer = modal.querySelector('.ticket-view-hub') || modal.querySelector('.admin-login-container');
            if (contentContainer) {
                contentContainer.innerHTML = content;
            } else {
                modal.innerHTML = `<div class="admin-login-container">${content}</div>`;
            }
            
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        },

        closeModal: function(modalId = 'ticket-modal') {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
            document.body.style.overflow = 'auto';
        },

        closeAllModals: function() {
            document.querySelectorAll('.admin-login-modal, .ticket-modal, .driver-portal-modal').forEach(modal => {
                modal.style.display = 'none';
            });
            document.body.style.overflow = 'auto';
        },

        // System Functions
        refreshDashboard: function() {
            Utils.showLoading(' ...');
            
            // Reload all data
            this.loadRoutes();
            this.loadDrivers();
            this.loadTickets();
            
            setTimeout(() => {
                Utils.hideLoading();
                Utils.showNotification(' !', 'success');
            }, 1000);
        },

        exportReports: function() {
            const reportData = {
                generated: new Date().toISOString(),
                routes: SystemState.routes.length,
                drivers: SystemState.drivers.length,
                tickets: SystemState.tickets.length,
                revenue: SystemState.stats.totalRevenue,
                activeRoutes: SystemState.routes.filter(r => {
                    const sales = r.sales ? Object.keys(r.sales).length : 0;
                    return sales < SystemState.settings.busSeats;
                }).length,
                popularRoutes: SystemState.routes
                    .map(r => ({
                        destination: r.dest,
                        sales: r.sales ? Object.keys(r.sales).length : 0,
                        revenue: (r.sales ? Object.keys(r.sales).length : 0) * parseInt(r.price)
                    }))
                    .sort((a, b) => b.sales - a.sales)
                    .slice(0, 10)
            };
            
            const data = JSON.stringify(reportData, null, 2);
            Utils.downloadFile(data, `osh-report-${Utils.getCurrentDate()}.json`, 'application/json');
            Utils.showNotification('  !', 'success');
        },

        backupSystem: function() {
            const backupData = {
                timestamp: new Date().toISOString(),
                routes: SystemState.routes,
                drivers: SystemState.drivers,
                tickets: SystemState.tickets,
                settings: SystemState.settings
            };
            
            const data = JSON.stringify(backupData, null, 2);
            Utils.downloadFile(data, `osh-backup-${Utils.getCurrentDate()}.json`, 'application/json');
            Utils.showNotification('   !', 'success');
        }
    };

    // Initialize the system when page loads
    window.addEventListener('DOMContentLoaded', () => {
        coreEngine.init();
        
        // Add admin nav button click handlers
        document.querySelectorAll('.admin-nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const section = btn.dataset.section;
                coreEngine.switchAdminSection(section);
            });
        });
    });

</script>
</body>
</html>